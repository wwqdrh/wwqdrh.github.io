<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>Kubernetes生产化实践之路5</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="description" content="Kubernetes生产化实践之路-第10-11-12章"/><meta property="og:type"/><meta property="og:title" content="Kubernetes生产化实践之路5"/><meta property="og:description" content="Kubernetes生产化实践之路-第10-11-12章"/><meta property="og:url" content="https://wwqdrh.github.io/undefined"/><meta name="keywords" content="wwqdrh技术博客"/><meta property="og:locale" content="zh-CN"/><meta property="og:image" content="https://wwqdrh.github.io"/><meta name="twitter:title" content="Kubernetes生产化实践之路5"/><meta name="twitter:description" content="Kubernetes生产化实践之路-第10-11-12章"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://wwqdrh.github.io"/><link rel="stylesheet" href="/assets/mdrender/editor-render.css"/><meta name="next-head-count" content="17"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><script src="/assets/analizy/clarity.js"></script><link rel="preload" href="/_next/static/media/d83e92f0af8b17e4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e52907b750a6f61e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ed42d1b51efd45f6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9031250013752d4b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/fba9d678ff638e59-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb9adf802b0a60eb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/81b352a4d7a000ae-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/41b9b3ece820718f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d587d1c112526568-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/869c7de7c781f904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/869c7de7c781f904.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-fbe37f60a09a330b.js" defer=""></script><script src="/_next/static/chunks/main-082d90b1269d95f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ebc472ae118a2be0.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-222bf60d0a2bf3df.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_buildManifest.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global c86wz">body{margin:0;padding:0;color:hsl(0, 0%, 9.0%);background-color:hsl(0, 0%, 97.3%);font-family:'__pretendard_6bb8e5','__pretendard_Fallback_6bb8e5';}*{-webkit-print-color-scheme:light;color-scheme:light;box-sizing:border-box;}h1,h2,h3,h4,h5,h6{margin:0;font-weight:inherit;font-style:inherit;}a{all:unset;cursor:pointer;}ul{padding:0;}button{all:unset;cursor:pointer;}input{all:unset;box-sizing:border-box;}textarea{border:none;background-color:transparent;font-family:inherit;padding:0;outline:none;resize:none;color:inherit;}hr{width:100%;border:none;margin:0;border-top:1px solid hsl(0, 0%, 88.7%);}</style><style data-emotion="css 1q70a33">.css-1q70a33{z-index:30;position:-webkit-sticky;position:sticky;top:0;background-color:hsl(0, 0%, 97.3%);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);}.css-1q70a33 .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:3rem;margin:0 auto;}@media (min-width: 768px){.css-1q70a33 .container[data-full-width="true"]{padding-left:6rem;padding-right:6rem;}}.css-1q70a33 .container .nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.75rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1q70a33 .container .mid{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1.25rem;padding-right:1.25rem;border-radius:1rem;outline-style:none;width:50%;background-color:hsl(0, 0%, 93.0%);}</style><div class="py-2 css-1q70a33"><div data-full-width="false" class="container"><a aria-label="wwqdrh" class="css-0" href="/">wwqdrh</a><input class="mid" type="text" placeholder="Search Keyword..." value=""/><div class="nav"><style data-emotion="css 1nw6zn9">.css-1nw6zn9{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-1nw6zn9 ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1nw6zn9 ul li{display:block;margin-left:1rem;color:hsl(0, 0%, 43.5%);}</style><div class="css-1nw6zn9"><ul><li><a target="_blank" href="https://space.bilibili.com/538676331">B站</a></li></ul></div><style data-emotion="css 1h5x3dy">.css-1h5x3dy{cursor:pointer;}</style><div class="css-1h5x3dy"><style data-emotion="css p95608">.css-p95608{font-family:'__Noto_Color_Emoji_be1378','__Noto_Color_Emoji_Fallback_be1378',Apple Color Emoji;font-weight:400;font-style:normal;}</style><span class="css-p95608">☀️</span></div></div></div></div><style data-emotion="css lomkhl">.css-lomkhl{margin:0 auto;width:100%;padding:0 3rem;}</style><main class="css-lomkhl"><div class="divide-y bg-white dark:bg-gray-700 p-6 shadow-lg rounded-lg mt-3 divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="max-w-none pt-10 pb-8 prose dark:prose-dark"><div><h1>应用落地</h1>
<p>微服务架构下的十二条最佳实践指导原则</p>
<ul>
<li>基础代码: 一份代码多份部署</li>
<li>依赖管理: 明确定义项目依赖</li>
<li>配置: 以配置文件或环境变量的方式注入应用中</li>
<li>后台服务: 无状态应用更易管理，需要与有状态服务进行隔离</li>
<li>进程管理: 进程应该是无状态的，任何数据都不应该做本地持久化</li>
<li>端口绑定: 以端口绑定的形式发布服务，容器进程运行在不同的网络命名空间，彼此隔离</li>
<li>并发: 应用可以按需伸缩</li>
<li>易管理: 快速启动时保证应用灵活部署的前提条件</li>
<li>研发生产环境的一致性</li>
<li>日志</li>
<li>管理进程</li>
</ul>
<p>Dockerfile的编写要考虑分层的复用、缓存的清理，或者使用多阶段构建(多个from)，最终镜像只会留下所需要的内容</p>
<p>对于容器多进程场景下容器的主进程选择，主流方案Systemd、Supervisior等，要能够负责业务进程的启动，接管孤儿进程回收僵尸进程，支持SIGTERM信号的处理，向子进程传播SIGTERM信号，优雅地结束所有子进程后退出。</p>
<h1>监控和自动修复</h1>
<p>基础平台服务的监控，实时监控核心组件(API Server、调度器、控制器、kubelet和kube-proxy等)的健康状态、用以发现用户流量好组件CPU、内存、网络的使用情况</p>
<p>监控系统的数据分为两大类，指标和日志</p>
<p>指标监控系统</p>
<ul>
<li>Heapster + InfluxDB + Grafana</li>
<li>Metrics-server + InfluxDB + Grafana</li>
<li>各种Exporter + Prometheus + Grafana + Alertmanager</li>
</ul>
<p>日志系统</p>
<ul>
<li>Filebeats + Logstash + Elastic + Kibana: ELK套件</li>
<li>Fluentd + Fluentd Aggregator + Influxdb + Grafana</li>
</ul>
<p>服务的关键性指标</p>
<ul>
<li>SLA: 服务级别协议</li>
<li>SLI: 服务水平指标</li>
<li>SLO: 服务水平目标</li>
</ul>
<h1>DevOps</h1>
<p>一个中心，两个基本点，以业务敏捷为中心，构造适应快速发布软件的工具和文化。透过自动化透明的&quot;软件交付&quot;和&quot;系统变更&quot;的流程，构建、测试、发布系统应用能够更加快捷、可靠。</p>
<p>GitOps使得整个交付系统以声明式方式进行描述，使用版本控制系统(Git)作为唯一的部署来源，其内包含应用部署于Kubernetes的所有信息。</p>
<p>5%的时间用于编码，95%的时间用于测试: 不可测试和没有经过测试的代码是不能交付的</p>
<p>测试需要贯穿始终</p>
</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"\u003ch1\u003e应用落地\u003c/h1\u003e\n\u003cp\u003e微服务架构下的十二条最佳实践指导原则\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e基础代码: 一份代码多份部署\u003c/li\u003e\n\u003cli\u003e依赖管理: 明确定义项目依赖\u003c/li\u003e\n\u003cli\u003e配置: 以配置文件或环境变量的方式注入应用中\u003c/li\u003e\n\u003cli\u003e后台服务: 无状态应用更易管理，需要与有状态服务进行隔离\u003c/li\u003e\n\u003cli\u003e进程管理: 进程应该是无状态的，任何数据都不应该做本地持久化\u003c/li\u003e\n\u003cli\u003e端口绑定: 以端口绑定的形式发布服务，容器进程运行在不同的网络命名空间，彼此隔离\u003c/li\u003e\n\u003cli\u003e并发: 应用可以按需伸缩\u003c/li\u003e\n\u003cli\u003e易管理: 快速启动时保证应用灵活部署的前提条件\u003c/li\u003e\n\u003cli\u003e研发生产环境的一致性\u003c/li\u003e\n\u003cli\u003e日志\u003c/li\u003e\n\u003cli\u003e管理进程\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eDockerfile的编写要考虑分层的复用、缓存的清理，或者使用多阶段构建(多个from)，最终镜像只会留下所需要的内容\u003c/p\u003e\n\u003cp\u003e对于容器多进程场景下容器的主进程选择，主流方案Systemd、Supervisior等，要能够负责业务进程的启动，接管孤儿进程回收僵尸进程，支持SIGTERM信号的处理，向子进程传播SIGTERM信号，优雅地结束所有子进程后退出。\u003c/p\u003e\n\u003ch1\u003e监控和自动修复\u003c/h1\u003e\n\u003cp\u003e基础平台服务的监控，实时监控核心组件(API Server、调度器、控制器、kubelet和kube-proxy等)的健康状态、用以发现用户流量好组件CPU、内存、网络的使用情况\u003c/p\u003e\n\u003cp\u003e监控系统的数据分为两大类，指标和日志\u003c/p\u003e\n\u003cp\u003e指标监控系统\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHeapster + InfluxDB + Grafana\u003c/li\u003e\n\u003cli\u003eMetrics-server + InfluxDB + Grafana\u003c/li\u003e\n\u003cli\u003e各种Exporter + Prometheus + Grafana + Alertmanager\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e日志系统\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFilebeats + Logstash + Elastic + Kibana: ELK套件\u003c/li\u003e\n\u003cli\u003eFluentd + Fluentd Aggregator + Influxdb + Grafana\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e服务的关键性指标\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSLA: 服务级别协议\u003c/li\u003e\n\u003cli\u003eSLI: 服务水平指标\u003c/li\u003e\n\u003cli\u003eSLO: 服务水平目标\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eDevOps\u003c/h1\u003e\n\u003cp\u003e一个中心，两个基本点，以业务敏捷为中心，构造适应快速发布软件的工具和文化。透过自动化透明的\u0026quot;软件交付\u0026quot;和\u0026quot;系统变更\u0026quot;的流程，构建、测试、发布系统应用能够更加快捷、可靠。\u003c/p\u003e\n\u003cp\u003eGitOps使得整个交付系统以声明式方式进行描述，使用版本控制系统(Git)作为唯一的部署来源，其内包含应用部署于Kubernetes的所有信息。\u003c/p\u003e\n\u003cp\u003e5%的时间用于编码，95%的时间用于测试: 不可测试和没有经过测试的代码是不能交付的\u003c/p\u003e\n\u003cp\u003e测试需要贯穿始终\u003c/p\u003e\n","frontMatter":{"readingTime":{"text":"4 min read","minutes":3.545,"time":212700,"words":709},"slug":"《Kubernetes生产化实践之路》读书笔记 - 5","fileName":"《Kubernetes生产化实践之路》读书笔记 - 5.md","title":"Kubernetes生产化实践之路5","date":"2022-08-12T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"Kubernetes生产化实践之路-第10-11-12章"}},"prev":{"title":"Kubernetes生产化实践之路3","date":"2022-08-11T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"Kubernetes生产化实践之路-第6-7章","slug":"《Kubernetes生产化实践之路》读书笔记 - 3"},"next":{"title":"Kubernetes生产化实践之路4","date":"2022-08-12T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"Kubernetes生产化实践之路-第8-9章","slug":"《Kubernetes生产化实践之路》读书笔记 - 4"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["《Kubernetes生产化实践之路》读书笔记 - 5"]},"buildId":"qwylQn0rAYfx_DG8FLkaO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>