<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>golang工程化纵览</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="description" content="golang工程化所用到的工具概览"/><meta property="og:type"/><meta property="og:title" content="golang工程化纵览"/><meta property="og:description" content="golang工程化所用到的工具概览"/><meta property="og:url" content="https://wwqdrh.github.io/undefined"/><meta name="keywords" content="wwqdrh技术博客"/><meta property="og:locale" content="zh-CN"/><meta property="og:image" content="https://wwqdrh.github.io"/><meta name="twitter:title" content="golang工程化纵览"/><meta name="twitter:description" content="golang工程化所用到的工具概览"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://wwqdrh.github.io"/><link rel="stylesheet" href="/assets/mdrender/editor-render.css"/><meta name="next-head-count" content="17"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><script src="/assets/analizy/clarity.js"></script><link rel="preload" href="/_next/static/media/d83e92f0af8b17e4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e52907b750a6f61e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ed42d1b51efd45f6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9031250013752d4b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/fba9d678ff638e59-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb9adf802b0a60eb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/81b352a4d7a000ae-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/41b9b3ece820718f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d587d1c112526568-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/869c7de7c781f904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/869c7de7c781f904.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-fbe37f60a09a330b.js" defer=""></script><script src="/_next/static/chunks/main-082d90b1269d95f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ebc472ae118a2be0.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-222bf60d0a2bf3df.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_buildManifest.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global c86wz">body{margin:0;padding:0;color:hsl(0, 0%, 9.0%);background-color:hsl(0, 0%, 97.3%);font-family:'__pretendard_6bb8e5','__pretendard_Fallback_6bb8e5';}*{-webkit-print-color-scheme:light;color-scheme:light;box-sizing:border-box;}h1,h2,h3,h4,h5,h6{margin:0;font-weight:inherit;font-style:inherit;}a{all:unset;cursor:pointer;}ul{padding:0;}button{all:unset;cursor:pointer;}input{all:unset;box-sizing:border-box;}textarea{border:none;background-color:transparent;font-family:inherit;padding:0;outline:none;resize:none;color:inherit;}hr{width:100%;border:none;margin:0;border-top:1px solid hsl(0, 0%, 88.7%);}</style><style data-emotion="css 1q70a33">.css-1q70a33{z-index:30;position:-webkit-sticky;position:sticky;top:0;background-color:hsl(0, 0%, 97.3%);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);}.css-1q70a33 .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:3rem;margin:0 auto;}@media (min-width: 768px){.css-1q70a33 .container[data-full-width="true"]{padding-left:6rem;padding-right:6rem;}}.css-1q70a33 .container .nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.75rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1q70a33 .container .mid{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1.25rem;padding-right:1.25rem;border-radius:1rem;outline-style:none;width:50%;background-color:hsl(0, 0%, 93.0%);}</style><div class="py-2 css-1q70a33"><div data-full-width="false" class="container"><a aria-label="wwqdrh" class="css-0" href="/">wwqdrh</a><input class="mid" type="text" placeholder="Search Keyword..." value=""/><div class="nav"><style data-emotion="css 1nw6zn9">.css-1nw6zn9{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-1nw6zn9 ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1nw6zn9 ul li{display:block;margin-left:1rem;color:hsl(0, 0%, 43.5%);}</style><div class="css-1nw6zn9"><ul><li><a target="_blank" href="https://space.bilibili.com/538676331">B站</a></li></ul></div><style data-emotion="css 1h5x3dy">.css-1h5x3dy{cursor:pointer;}</style><div class="css-1h5x3dy"><style data-emotion="css p95608">.css-p95608{font-family:'__Noto_Color_Emoji_be1378','__Noto_Color_Emoji_Fallback_be1378',Apple Color Emoji;font-weight:400;font-style:normal;}</style><span class="css-p95608">☀️</span></div></div></div></div><style data-emotion="css lomkhl">.css-lomkhl{margin:0 auto;width:100%;padding:0 3rem;}</style><main class="css-lomkhl"><div class="divide-y bg-white dark:bg-gray-700 p-6 shadow-lg rounded-lg mt-3 divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="max-w-none pt-10 pb-8 prose dark:prose-dark"><div><h1>fmt</h1>
<p>代码风格格式化 gofmt、go fmt标准工具</p>
<h1>vet</h1>
<p>捕捉可能出现的错误 标准工具 一般来说编辑器例如vscode都已经集成了这些功能，所以不需要单独检测</p>
<p><code>go vet -all</code></p>
<p>vet一般是检查</p>
<pre><code class="hljs language-go">package main 
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span> 

<span class="hljs-comment">// Prints out &quot;Super Mario 3&quot; </span>
func <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) { 
    game_version :=<span class="hljs-number">3</span> 
    fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">&quot;Super Mario %s\n&quot;</span>,game_version) 
    <span class="hljs-comment">// ./main.go:6:2: Printf format %s has arg 3 of wrong type int</span>
}
</code></pre><h1>lint</h1>
<p>代码静态检查</p>
<p>golint、golangci-lint</p>
<h2>golangci-lint</h2>
<blockquote>
<p>参考: <a href="https://golangci-lint.run/usage/configuration/">https://golangci-lint.run/usage/configuration/</a></p>
</blockquote>
<p><code>golangci-lint run</code></p>
<p><code>.golangci.yaml</code>配置lint选项</p>
<h3>配置项</h3>
<p>run</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">run:</span>
  <span class="hljs-attr">concurrency:</span> <span class="hljs-number">4</span>
  <span class="hljs-attr">timeout:</span> <span class="hljs-string">5m</span>
  <span class="hljs-attr">issues-exit-code:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">tests:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">build-tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mytag</span>
  <span class="hljs-attr">skip-dirs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">src/external_libs</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">autogenerated_by_my_lib</span>
  <span class="hljs-attr">skip-dirs-use-default:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">skip-files:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;.*\\.my\\.go$&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">lib/bad.go</span>
  <span class="hljs-attr">modules-download-mode:</span> <span class="hljs-string">readonly</span> <span class="hljs-comment"># readonly|vendor|mod</span>
  <span class="hljs-attr">allow-parallel-runners:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># If false (default) - golangci-lint acquires file lock on start.</span>
  <span class="hljs-attr">go:</span> <span class="hljs-string">&#x27;1.18&#x27;</span>
</code></pre><p>output</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">output:</span>
  <span class="hljs-attr">format:</span> <span class="hljs-string">json</span> <span class="hljs-comment"># colored-line-number|line-number|json|tab|checkstyle|code-climate|junit-xml|github-actions</span>
  <span class="hljs-attr">print-issued-lines:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">print-linter-name:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">uniq-by-line:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">path-prefix:</span> <span class="hljs-string">&quot;&quot;</span>
  <span class="hljs-attr">sort-results:</span> <span class="hljs-literal">false</span>
</code></pre><p>linters</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">linters:</span>
  <span class="hljs-attr">disable-all:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Default: false</span>
  <span class="hljs-comment"># Enable specific linter</span>
  <span class="hljs-comment"># https://golangci-lint.run/usage/linters/#enabled-by-default</span>
  <span class="hljs-attr">enable:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">asasalint</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">asciicheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">bidichk</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">bodyclose</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">containedctx</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">contextcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">cyclop</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">deadcode</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">decorder</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">depguard</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">dogsled</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">dupl</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">dupword</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">durationcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">errcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">errchkjson</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">errname</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">errorlint</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">execinquery</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">exhaustive</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">exhaustivestruct</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">exhaustruct</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">exportloopref</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">forbidigo</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">forcetypeassert</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">funlen</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gci</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gochecknoglobals</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gochecknoinits</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gocognit</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">goconst</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gocritic</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gocyclo</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">godot</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">godox</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">goerr113</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gofmt</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gofumpt</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">goheader</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">goimports</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">golint</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gomnd</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gomoddirectives</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gomodguard</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">goprintffuncname</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gosec</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gosimple</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">govet</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">grouper</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ifshort</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">importas</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ineffassign</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">interfacebloat</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">interfacer</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ireturn</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">lll</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">loggercheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">maintidx</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">makezero</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">maligned</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">misspell</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nakedret</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nestif</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nilerr</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nilnil</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nlreturn</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">noctx</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nolintlint</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nonamedreturns</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nosnakecase</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">nosprintfhostport</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">paralleltest</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">prealloc</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">predeclared</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">promlinter</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">reassign</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">revive</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">rowserrcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">scopelint</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">sqlclosecheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">staticcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">structcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">stylecheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">tagliatelle</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">tenv</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">testableexamples</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">testpackage</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">thelper</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">tparallel</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">typecheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">unconvert</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">unparam</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">unused</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">usestdlibvars</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">varcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">varnamelen</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">wastedassign</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">whitespace</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">wrapcheck</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">wsl</span>
  <span class="hljs-attr">enable-all:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># Default: false</span>
  <span class="hljs-attr">disable:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-comment"># 同enable项一样</span>
  <span class="hljs-comment"># Enable presets.</span>
  <span class="hljs-comment"># https://golangci-lint.run/usage/linters</span>
  <span class="hljs-attr">presets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">bugs</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">comment</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">complexity</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">error</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">format</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">import</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">metalinter</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">module</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">performance</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">sql</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">style</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">test</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">unused</span>
  <span class="hljs-comment"># Run only fast linters from enabled linters set (first run won&#x27;t be fast)</span>
  <span class="hljs-comment"># Default: false</span>
  <span class="hljs-attr">fast:</span> <span class="hljs-literal">true</span>
</code></pre><p>issues</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">issues:</span>
  <span class="hljs-attr">exclude:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">abcdef</span>
  <span class="hljs-comment"># Excluding configuration per-path, per-linter, per-text and per-source</span>
  <span class="hljs-attr">exclude-rules:</span>
    <span class="hljs-comment"># Exclude some linters from running on tests files.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">_test\.go</span>
      <span class="hljs-attr">linters:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">gocyclo</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">errcheck</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">dupl</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">gosec</span>
    <span class="hljs-comment"># Exclude known linters from partially hard-vendored code,</span>
    <span class="hljs-comment"># which is impossible to exclude via `nolint` comments.</span>
    <span class="hljs-comment"># `/` will be replaced by current OS file path separator to properly work on Windows.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">internal/hmac/</span>
      <span class="hljs-attr">text:</span> <span class="hljs-string">&quot;weak cryptographic primitive&quot;</span>
      <span class="hljs-attr">linters:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">gosec</span>
    <span class="hljs-comment"># Exclude some `staticcheck` messages.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">linters:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">staticcheck</span>
      <span class="hljs-attr">text:</span> <span class="hljs-string">&quot;SA9003:&quot;</span>
    <span class="hljs-comment"># Exclude `lll` issues for long lines with `go:generate`.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">linters:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">lll</span>
      <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;^//go:generate &quot;</span>
  <span class="hljs-attr">exclude-use-default:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">exclude-case-sensitive:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># The list of ids of default excludes to include or disable.</span>
  <span class="hljs-comment"># https://golangci-lint.run/usage/false-positives/#default-exclusions</span>
  <span class="hljs-comment"># Default: []</span>
  <span class="hljs-attr">include:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0001</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0002</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0003</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0004</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0005</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0006</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0007</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0008</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0009</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0010</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0011</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0012</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0013</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0014</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">EXC0015</span>
  <span class="hljs-comment"># Maximum issues count per one linter.</span>
  <span class="hljs-comment"># Set to 0 to disable.</span>
  <span class="hljs-comment"># Default: 50</span>
  <span class="hljs-attr">max-issues-per-linter:</span> <span class="hljs-number">0</span>
  <span class="hljs-comment"># Maximum count of issues with the same text.</span>
  <span class="hljs-comment"># Set to 0 to disable.</span>
  <span class="hljs-comment"># Default: 3</span>
  <span class="hljs-attr">max-same-issues:</span> <span class="hljs-number">0</span>
  <span class="hljs-comment"># Show only new issues: if there are unstaged changes or untracked files,</span>
  <span class="hljs-comment"># only those changes are analyzed, else only changes in HEAD~ are analyzed.</span>
  <span class="hljs-comment"># It&#x27;s a super-useful option for integration of golangci-lint into existing large codebase.</span>
  <span class="hljs-comment"># It&#x27;s not practical to fix all existing issues at the moment of integration:</span>
  <span class="hljs-comment"># much better don&#x27;t allow issues in new code.</span>
  <span class="hljs-comment">#</span>
  <span class="hljs-comment"># Default: false.</span>
  <span class="hljs-attr">new:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># Show only new issues created after git revision `REV`.</span>
  <span class="hljs-attr">new-from-rev:</span> <span class="hljs-string">HEAD</span>
  <span class="hljs-comment"># Show only new issues created in git patch with set file path.</span>
  <span class="hljs-attr">new-from-patch:</span> <span class="hljs-string">path/to/patch/file</span>
  <span class="hljs-comment"># Fix found issues (if it&#x27;s supported by the linter).</span>
  <span class="hljs-attr">fix:</span> <span class="hljs-literal">true</span>
</code></pre><p>severity</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">severity:</span>
  <span class="hljs-attr">default-severity:</span> <span class="hljs-string">error</span>
  <span class="hljs-attr">case-sensitive:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">rules:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">linters:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">dupl</span>
      <span class="hljs-attr">severity:</span> <span class="hljs-string">info</span>
</code></pre><h1>单元测试</h1>
<p>在单元测试领域，关于如何替换掉外部依赖，主要有两种技术，分别是 mock 和 stub：mock 通过接口可以动态调整外部依赖的返回值，而 stub 只能在运行时静态调整外部依赖的返回值</p>
<blockquote>
<p>使用这些都是就是为了替换外部依赖时候使用的，只是为了单元测试覆盖率变高一点😹</p>
</blockquote>
<pre><code class="hljs language-bash">github.com/stretchr/testify/<span class="hljs-keyword">assert</span>

github.com/smartystreets/goconvey/convey

github.com/golang/mock/gomock
</code></pre><p><code>go install github.com/golang/mock/mockgen@latest</code></p>
<h2>gotest</h2>
<p>官方内置的工具</p>
<ul>
<li>性能测试</li>
</ul>
<p><code>go test -bench</code></p>
<p>定义Bench开头的测试函数</p>
<ul>
<li>覆盖率</li>
</ul>
<p><code>go test -cover</code></p>
<ul>
<li>竞态检查</li>
</ul>
<p><code>go test -race</code>用于检查代码中是否存在并发安全问题</p>
<h2>testify</h2>
<ul>
<li>assert</li>
<li>require(与assert一样，不过异常会退出)</li>
<li>mock</li>
</ul>
<blockquote>
<p>在要编写一个从一个站点拉取用户列表信息的程序，拉取完成之后程序显示和分析。如果每次都去访问网络会带来极大的不确定性，甚至每次返回不同的列表，这就给测试带来了极大的困难。我们可以使用 Mock 技术。</p>
</blockquote>
<p>但是问题在于如果直接使用新的接口进行了替换，那么会导致有些代码分支进入不到，覆盖率降低</p>
<ul>
<li>suite</li>
</ul>
<h2>gomock</h2>
<p><code>go mock</code></p>
<pre><code class="hljs language-bash">go get -u github.com/golang/mock/gomock go get -u github.com/golang/mock/mockgen
</code></pre><p>要使用gomock的一个前提是模块之间务必通过接口进行依赖，而不是依赖具体实现，否则mock会非常困难。这个工具目前业界用的并不多，主要是局限性太大</p>
<p>在实际项目中，当需要进行单元测试时，往往会有很多的依赖项，有些依赖可能还没有办法直接进行创建，例如数据库连接，文件 I/O 等。此时通过使用 go mock 可以模拟依赖项，简化测试。</p>
<p><strong>桩</strong>，或称桩代码，是指用来代替关联代码或者未实现代码的代码。如果函数 B 用 B1 来代替，那么，B 称为原函数，B1 称为桩函数。打桩就是编写或生成桩代码。</p>
<h2>gostub</h2>
<p><code>go get github.com/prashantv/gostub</code></p>
<ul>
<li>为一个全局变量打桩</li>
<li>为一个函数打桩</li>
<li>为一个过程打桩</li>
<li>由任意相同或不同的基本场景组合而成</li>
</ul>
<pre><code class="hljs language-go">func <span class="hljs-title class_">TestStubMethod</span>(t *testing.<span class="hljs-property">T</span>) {
    <span class="hljs-keyword">var</span> printStr = <span class="hljs-title function_">func</span>(val string) string {
        <span class="hljs-keyword">return</span> val
    }

    <span class="hljs-comment">// 针对有参数有返回值的</span>
    stubs := gostub.<span class="hljs-title class_">Stub</span>(&amp;printStr, <span class="hljs-title function_">func</span>(val string) string {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello,&quot;</span> + val
    })
    defer stubs.<span class="hljs-title class_">Reset</span>()
    fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">&quot;After stub: &quot;</span>, <span class="hljs-title function_">printStr</span>(<span class="hljs-string">&quot;hhhhh&quot;</span>))

    <span class="hljs-keyword">var</span> printStr2 = <span class="hljs-title function_">func</span>(val string) string {
        <span class="hljs-keyword">return</span> val
    }
    <span class="hljs-comment">// StubFunc 第一个参数必须是一个函数变量的指针，该指针指向的必须是一个函数变量，第二个参数为函数 mock 的返回值</span>
    stubs2 := gostub.<span class="hljs-title class_">StubFunc</span>(&amp;printStr2, <span class="hljs-string">&quot;ddddd,万生世代&quot;</span>)
    defer stubs2.<span class="hljs-title class_">Reset</span>()
    fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">&quot;After stub:&quot;</span>, <span class="hljs-title function_">printStr2</span>(<span class="hljs-string">&quot;lalala&quot;</span>))
}
</code></pre><h2>gomonkey</h2>
<p><code>github.com/agiledragon/gomonkey/v2</code></p>
<p>1、它违反了开闭原则。
2、运行时必须关闭内连「go test -gcflags=all=-l」。
3、运行时需要很高的权限，并且不同的硬件需要不同的黑科技实现</p>
<ol>
<li>直接在方法级别上进行 mock<br>（在运行时通过汇编语句重写可执行文件，将待打桩函数或方法的实现跳转到桩实现）<br>在编译阶段直接替换掉真的函数代码部分  </li>
<li>非线程安全，请勿用于并发测试</li>
</ol>
<p>并且必须加上<code>&quot;-gcflags=all=-l&quot;</code>, 避免内联优化(短函数直接被合并不会单独作为一个函数)导致测试失败</p>
<pre><code class="hljs language-go">func DoSomething(name string, args ...string) (string, error) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, errors.New(<span class="hljs-string">&quot;TODO&quot;</span>)
}

func TestExec(t *testing.T) {
    patches := gomonkey.NewPatches()
    defer patches.Reset()
    outputExpect := <span class="hljs-string">&quot;xxx-vethName100-yyy&quot;</span>
    guard := patches.ApplyFunc(DoSomething, func(_ string, _ ...string) (string, error) {
        <span class="hljs-keyword">return</span> outputExpect, nil
    })
    defer guard.Reset()
    output, err := DoSomething(<span class="hljs-string">&quot;asd&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>)
    <span class="hljs-keyword">assert</span>.Nil(t, err)
    <span class="hljs-keyword">assert</span>.Equal(t, outputExpect, output)
}
</code></pre><h2>http测试</h2>
<p>在 web 项目中，大多接口是处理 http 请求（post、get 之类的），在测试环境中，是访问不到它发起的 get 请求的 url 的，此时就可以模拟 http 请求来写测试。可以利用官方自带的 http 包来进行模拟请求。</p>
<h2>sql测试</h2>
<p>模拟任何实现了 sql/driver 接口的 db 驱动，无需关注 db 连接。</p>
<h1>性能调优</h1>
<p>使用go内置的工具pprof即可分析程序运行状态的整体情况</p>
<table>
<thead>
<tr>
<th>allocs</th>
<th>内存分配情况的采样信息</th>
</tr>
</thead>
<tbody><tr>
<td>blocks</td>
<td>阻塞操作情况的采样信息</td>
</tr>
<tr>
<td>cmdline</td>
<td>程序启动命令参数</td>
</tr>
<tr>
<td>goroutine</td>
<td>所有协程的堆栈信息</td>
</tr>
<tr>
<td>heap</td>
<td>堆上的内存分配情况</td>
</tr>
<tr>
<td>mutex</td>
<td>锁竞争情况的采样信息</td>
</tr>
<tr>
<td>profile</td>
<td>cpu占用情况的采样信息</td>
</tr>
<tr>
<td>threadcreate</td>
<td>系统线程创建情况的采样信息</td>
</tr>
<tr>
<td>trace</td>
<td>程序运行跟踪信息</td>
</tr>
</tbody></table>
<ul>
<li>runtim/pprof: 手动调用，一般在函数入口中</li>
<li>net/http/pprof: 用于web系统中，不过只是对runtime/pprof的简单封装</li>
<li>gin-contrib提供了对net/http/pprof的封装，能够在gin中使用</li>
</ul>
<blockquote>
<p>需要注意的是，profile所显示的时间明显小于接口调用的时间，是因为profile只能够分析cpu的耗时，无法计算io情况(因为io不会占用cpu)</p>
</blockquote>
<pre><code class="hljs language-bash"><span class="hljs-comment"># 下载cpu profile，默认从当前开始收集30s的cpu使用情况，需要等待30s</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/profile</span>   <span class="hljs-comment"># 30-second CPU profile</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/profile?seconds=120</span>     <span class="hljs-comment"># wait 120s</span>

<span class="hljs-comment"># 下载heap profile</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/heap</span>      <span class="hljs-comment"># heap profile</span>

<span class="hljs-comment"># 下载goroutine profile</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/goroutine</span> <span class="hljs-comment"># goroutine profile</span>

<span class="hljs-comment"># 下载block profile</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/block</span>     <span class="hljs-comment"># goroutine blocking profile</span>

<span class="hljs-comment"># 下载mutex profile</span>
<span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">pprof</span> <span class="hljs-string">http://localhost:6060/debug/pprof/mutex</span>
</code></pre><h2>trace</h2>
<p>trace工具，用于查看整个周期内发生的事件，指定的Goroutines何时执行、执行 了多长时间、什么时候陷入了堵塞、什么时候解除了堵塞、GC如何影 响单个Goroutine的执行、STW中断花费的时间是否太长等 。</p>
<ul>
<li>协程的创建、开始和结束</li>
<li>协程的堵塞-系统调用、通道、锁</li>
<li>网络I/O相关事件</li>
<li>系统调用事件</li>
<li>垃圾回收相关事件</li>
</ul>
<pre><code class="hljs language-go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;runtime/trace&quot;</span>

trace.<span class="hljs-title class_">Start</span>(f)

defer trace.<span class="hljs-title class_">Stop</span>()

<span class="hljs-comment">// or use net/pprof</span>
<span class="hljs-comment">// curl -o trace.out http.../debug/pprof/trace?second=20</span>

<span class="hljs-comment">// 然后使用go tool trace trace.out进行分析</span>
</code></pre><p>在trace的初始阶段需要首先STW，然后获取协程的快照、状态、栈帧信息，然后开启GC重新启动所有协程。go源码中对于关键事件都加了判断是否开启了trace，开启后，触发这些事件时都会写入。</p>
<p>关键的事件包括协程的生命周期、协程堵塞、网络I/O、系统 调用、垃圾回收等，根据事件的不同，可能保存和此事件相关的不同 数量的参数及栈追踪数据。每个逻辑处理器P都有一个缓存 (p.tracebuf)，用于存储已经被序列化为字节的事件(Event) 。每个p的tracebuf都有限度，超过之后会转移到全局链表。</p>
<p>trace工具会新开一个协程专门用于读取全局trace上的信息， 此时全局的事件对象已经是序列化之后的字节数组，直接添加到文件 中即可。另外，访问全局trace缓存需要加锁，当没有可以访问的对象 时，读取协程会陷入休眠状态 。</p>
<p>当指定的事件到期后结束trace任务程序再次进入STW，刷新逻辑处理器P上的tracebuf缓存</p>
<h2>pyroscope</h2>
<p>基于pprof数据的可视化工具，提供上报和拉取两种模式</p>
<p>支持多种语言</p>
<p>可以将各个服务的运行数据集中起来，更利于管理</p>
<p>不过只能获取到当前时间点的内存分配情况、当前使用的内存情况，以及CPU耗时等</p>
<p><del>另外，除了无法对协程数、mutex等进行分析</del>, 又错怪了😹，pyroscope支持的分析维度包括(cpu、inuse_objects、alloc_objects、inuse_space，alloc_space, goroutines、mutex_duration、block_count、block_duration，这里面除了pprof，应该还用了trace包里面的数据)</p>
<p><del>绘制的时间曲线没有具体的数值，也无法查看具体时间点下的数据情况</del>(错怪了，时间区间选择可以用鼠标滑动选择，无法点击某个特定的柱形结构)</p>
<h2>排查CPU占用过高</h2>
<p>top命令确认</p>
<p><code>go tool pprof http://localhost:6060/debug/pprof/profile</code></p>
<p>进入交互使用top查看CPU占用较高的调用</p>
<p>top</p>
<p>使用list 名字 查看调用的具体位置</p>
<p>list Eat</p>
<p>如果安装了graphviz工具，使用web命令之后能够在web界面上看到调用链路图</p>
<p>brew install graphviz</p>
<img src="/images/blogs/cpu-web.png" />

<p>修复问题代码继续后面的操作</p>
<h2>排查内存占用过高</h2>
<p>修复代码中的死循环，再次使用top会发现CPU占用率下来了</p>
<p><code>go tool pprof http://localhost:6060/debug/pprof/heap</code></p>
<p>再次使用top、list定位到问题代码</p>
<pre><code class="hljs language-bash"><span class="hljs-attr">Total:</span> <span class="hljs-number">1.</span><span class="hljs-string">50GB</span>
<span class="hljs-string">ROUTINE</span> <span class="hljs-string">========================</span> <span class="hljs-string">github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal</span> <span class="hljs-string">in</span> <span class="hljs-string">/Users/dengronghui/Documents/Apps/public/handbook/Golang/go-pprof-practice-master/animal/muridae/mouse/mouse.go</span>
    <span class="hljs-number">1.</span><span class="hljs-string">50GB</span>     <span class="hljs-number">1.</span><span class="hljs-string">50GB</span> <span class="hljs-string">(flat,</span> <span class="hljs-string">cum)</span> <span class="hljs-number">99.90</span><span class="hljs-string">%</span> <span class="hljs-string">of</span> <span class="hljs-string">Total</span>
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-attr">45:</span>
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-number">46</span><span class="hljs-string">:func</span> <span class="hljs-string">(m</span> <span class="hljs-string">*Mouse)</span> <span class="hljs-string">Steal()</span> {
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-attr">47:</span>	<span class="hljs-string">log.Println(m.Name()</span>, <span class="hljs-string">&quot;steal&quot;</span><span class="hljs-string">)</span>
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-attr">48:</span>	<span class="hljs-string">max</span> <span class="hljs-string">:=</span> <span class="hljs-string">constant.Gi</span>
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-attr">49:</span>	<span class="hljs-string">for</span> <span class="hljs-string">len(m.buffer)*constant.Mi</span> <span class="hljs-string">&lt;</span> <span class="hljs-string">max</span> {
    <span class="hljs-attr">1.50GB     1.50GB     50:</span>		<span class="hljs-string">m.buffer</span> <span class="hljs-string">=</span> <span class="hljs-string">append(m.buffer</span>, [<span class="hljs-string">constant.Mi</span>]<span class="hljs-string">byte</span>{}<span class="hljs-string">)</span>
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-attr">51:</span>	}
         <span class="hljs-string">.</span>          <span class="hljs-string">.</span>     <span class="hljs-number">52</span><span class="hljs-string">:</span>}
</code></pre><p>同样可以使用web可视化展示</p>
<h2>排查频繁内存回收</h2>
<p>获取程序运行时的GC日志</p>
<pre><code class="hljs language-bash">gc 1 @0.003s 7%: 0.022+2.1+0.002 ms clock, 0.18+1.1/1.9/3.0+0.019 ms cpu, 4-&gt;4-&gt;3 MB, 5 MB goal, 8 P
gc 2 @0.018s 3%: 0.009+1.8+0.001 ms clock, 0.073+0.096/2.2/0.16+0.013 ms cpu, 7-&gt;7-&gt;6 MB, 8 MB goal, 8 P
gc 3 @0.089s 0%: 0.022+0.92+0.013 ms clock, 0.17+0.095/1.0/0.75+0.10 ms cpu, 16-&gt;16-&gt;14 MB, 17 MB goal, 8 P
gc 4 @0.489s 0%: 0.023+1.5+0.014 ms clock, 0.18+0/2.4/1.1+0.11 ms cpu, 29-&gt;29-&gt;15 MB, 30 MB goal, 8 P
gc 1 @0.003s 1%: 0.013+0.55+0.002 ms clock, 0.013+0.22/0.17/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
gc 2 @3.020s 0%: 0.070+0.56+0.002 ms clock, 0.070+0.17/0.20/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
gc 3 @6.027s 0%: 0.15+0.98+0.003 ms clock, 0.15+0.36/0.36/0+0.003 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
gc 4 @9.034s 0%: 0.10+0.63+0.002 ms clock, 0.10+0.16/0.23/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
gc 5 @12.040s 0%: 0.070+0.53+0.002 ms clock, 0.070+0.23/0.19/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
gc 6 @15.047s 0%: 0.11+0.66+0.002 ms clock, 0.11+0.23/0.27/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P
</code></pre><img src="/images/blogs/gc_info.png" />

<p>每次gc都从16MB释放到0MB，说明程序在不断的声明然后释放内存</p>
<p>接下来使用 pprof 排查时，我们在乎的不是什么地方在占用大量内存，而是什么地方在不停地申请内</p>
<p><code>go tool pprof http://localhost:6060/debug/pprof/allocs</code></p>
<h2>排查协程泄漏</h2>
<p><code>go tool pprof http://localhost:6060/debug/pprof/goroutine</code></p>
<p>同样使用top、list、web即可定位到</p>
<h2>排查锁的争用</h2>
<p><code>go tool pprof http://localhost:6060/debug/pprof/mutex</code></p>
</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"\u003ch1\u003efmt\u003c/h1\u003e\n\u003cp\u003e代码风格格式化 gofmt、go fmt标准工具\u003c/p\u003e\n\u003ch1\u003evet\u003c/h1\u003e\n\u003cp\u003e捕捉可能出现的错误 标准工具 一般来说编辑器例如vscode都已经集成了这些功能，所以不需要单独检测\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego vet -all\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003evet一般是检查\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003epackage main \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;fmt\u0026quot;\u003c/span\u003e \n\n\u003cspan class=\"hljs-comment\"\u003e// Prints out \u0026quot;Super Mario 3\u0026quot; \u003c/span\u003e\nfunc \u003cspan class=\"hljs-title function_\"\u003emain\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) { \n    game_version :=\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e \n    fmt.\u003cspan class=\"hljs-title class_\"\u003ePrintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Super Mario %s\\n\u0026quot;\u003c/span\u003e,game_version) \n    \u003cspan class=\"hljs-comment\"\u003e// ./main.go:6:2: Printf format %s has arg 3 of wrong type int\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch1\u003elint\u003c/h1\u003e\n\u003cp\u003e代码静态检查\u003c/p\u003e\n\u003cp\u003egolint、golangci-lint\u003c/p\u003e\n\u003ch2\u003egolangci-lint\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考: \u003ca href=\"https://golangci-lint.run/usage/configuration/\"\u003ehttps://golangci-lint.run/usage/configuration/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003egolangci-lint run\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.golangci.yaml\u003c/code\u003e配置lint选项\u003c/p\u003e\n\u003ch3\u003e配置项\u003c/h3\u003e\n\u003cp\u003erun\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003econcurrency:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etimeout:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eissues-exit-code:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etests:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild-tags:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emytag\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eskip-dirs:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esrc/external_libs\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eautogenerated_by_my_lib\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eskip-dirs-use-default:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eskip-files:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;.*\\\\.my\\\\.go$\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elib/bad.go\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emodules-download-mode:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# readonly|vendor|mod\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eallow-parallel-runners:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# If false (default) - golangci-lint acquires file lock on start.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ego:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;1.18\u0026#x27;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eoutput\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eoutput:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eformat:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ejson\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# colored-line-number|line-number|json|tab|checkstyle|code-climate|junit-xml|github-actions\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eprint-issued-lines:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eprint-linter-name:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euniq-by-line:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epath-prefix:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003esort-results:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003elinters\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edisable-all:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# Default: false\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Enable specific linter\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# https://golangci-lint.run/usage/linters/#enabled-by-default\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eenable:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003easasalint\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003easciicheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebidichk\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebodyclose\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003econtainedctx\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003econtextcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecyclop\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edeadcode\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edecorder\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edepguard\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edogsled\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edupl\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edupword\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edurationcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerrcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerrchkjson\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerrname\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerrorlint\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexecinquery\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexhaustive\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexhaustivestruct\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexhaustruct\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexportloopref\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eforbidigo\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eforcetypeassert\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003efunlen\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egci\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egochecknoglobals\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egochecknoinits\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egocognit\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoconst\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egocritic\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egocyclo\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egodot\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egodox\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoerr113\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egofmt\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egofumpt\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoheader\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoimports\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egolint\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egomnd\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egomoddirectives\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egomodguard\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egoprintffuncname\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egosec\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egosimple\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egovet\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egrouper\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eifshort\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eimportas\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eineffassign\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einterfacebloat\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einterfacer\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eireturn\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elll\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eloggercheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emaintidx\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emakezero\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emaligned\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emisspell\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enakedret\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enestif\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enilerr\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enilnil\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enlreturn\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enoctx\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enolintlint\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enonamedreturns\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enosnakecase\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enosprintfhostport\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eparalleltest\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eprealloc\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epredeclared\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epromlinter\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ereassign\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erevive\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erowserrcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003escopelint\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esqlclosecheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estaticcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estructcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estylecheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etagliatelle\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etenv\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etestableexamples\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etestpackage\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ethelper\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etparallel\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etypecheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eunconvert\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eunparam\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eunused\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eusestdlibvars\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003evarcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003evarnamelen\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewastedassign\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewhitespace\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrapcheck\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewsl\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eenable-all:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# Default: false\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edisable:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# 同enable项一样\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Enable presets.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# https://golangci-lint.run/usage/linters\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epresets:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebugs\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecomment\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecomplexity\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerror\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eformat\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eimport\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emetalinter\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emodule\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eperformance\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esql\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estyle\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eunused\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Run only fast linters from enabled linters set (first run won\u0026#x27;t be fast)\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Default: false\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003efast:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eissues\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eissues:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eexclude:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eabcdef\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Excluding configuration per-path, per-linter, per-text and per-source\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eexclude-rules:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# Exclude some linters from running on tests files.\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epath:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e_test\\.go\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egocyclo\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerrcheck\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edupl\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egosec\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# Exclude known linters from partially hard-vendored code,\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# which is impossible to exclude via `nolint` comments.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# `/` will be replaced by current OS file path separator to properly work on Windows.\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epath:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einternal/hmac/\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003etext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;weak cryptographic primitive\u0026quot;\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egosec\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# Exclude some `staticcheck` messages.\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estaticcheck\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003etext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;SA9003:\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# Exclude `lll` issues for long lines with `go:generate`.\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elll\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003esource:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^//go:generate \u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eexclude-use-default:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eexclude-case-sensitive:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# The list of ids of default excludes to include or disable.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# https://golangci-lint.run/usage/false-positives/#default-exclusions\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Default: []\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003einclude:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0001\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0002\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0003\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0004\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0005\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0006\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0007\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0008\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0009\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0010\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0011\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0012\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0013\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0014\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEXC0015\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Maximum issues count per one linter.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Set to 0 to disable.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Default: 50\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emax-issues-per-linter:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Maximum count of issues with the same text.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Set to 0 to disable.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Default: 3\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emax-same-issues:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Show only new issues: if there are unstaged changes or untracked files,\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# only those changes are analyzed, else only changes in HEAD~ are analyzed.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# It\u0026#x27;s a super-useful option for integration of golangci-lint into existing large codebase.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# It\u0026#x27;s not practical to fix all existing issues at the moment of integration:\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# much better don\u0026#x27;t allow issues in new code.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Default: false.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003enew:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Show only new issues created after git revision `REV`.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003enew-from-rev:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eHEAD\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Show only new issues created in git patch with set file path.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003enew-from-patch:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epath/to/patch/file\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Fix found issues (if it\u0026#x27;s supported by the linter).\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003efix:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eseverity\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eseverity:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edefault-severity:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eerror\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ecase-sensitive:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erules:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elinters:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edupl\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eseverity:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einfo\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch1\u003e单元测试\u003c/h1\u003e\n\u003cp\u003e在单元测试领域，关于如何替换掉外部依赖，主要有两种技术，分别是 mock 和 stub：mock 通过接口可以动态调整外部依赖的返回值，而 stub 只能在运行时静态调整外部依赖的返回值\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e使用这些都是就是为了替换外部依赖时候使用的，只是为了单元测试覆盖率变高一点😹\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egithub.com/stretchr/testify/\u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e\n\ngithub.com/smartystreets/goconvey/convey\n\ngithub.com/golang/mock/gomock\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ego install github.com/golang/mock/mockgen@latest\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003egotest\u003c/h2\u003e\n\u003cp\u003e官方内置的工具\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e性能测试\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003ego test -bench\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e定义Bench开头的测试函数\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e覆盖率\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003ego test -cover\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e竞态检查\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003ego test -race\u003c/code\u003e用于检查代码中是否存在并发安全问题\u003c/p\u003e\n\u003ch2\u003etestify\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eassert\u003c/li\u003e\n\u003cli\u003erequire(与assert一样，不过异常会退出)\u003c/li\u003e\n\u003cli\u003emock\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在要编写一个从一个站点拉取用户列表信息的程序，拉取完成之后程序显示和分析。如果每次都去访问网络会带来极大的不确定性，甚至每次返回不同的列表，这就给测试带来了极大的困难。我们可以使用 Mock 技术。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e但是问题在于如果直接使用新的接口进行了替换，那么会导致有些代码分支进入不到，覆盖率降低\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esuite\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003egomock\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ego mock\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ego get -u github.com/golang/mock/gomock go get -u github.com/golang/mock/mockgen\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e要使用gomock的一个前提是模块之间务必通过接口进行依赖，而不是依赖具体实现，否则mock会非常困难。这个工具目前业界用的并不多，主要是局限性太大\u003c/p\u003e\n\u003cp\u003e在实际项目中，当需要进行单元测试时，往往会有很多的依赖项，有些依赖可能还没有办法直接进行创建，例如数据库连接，文件 I/O 等。此时通过使用 go mock 可以模拟依赖项，简化测试。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e桩\u003c/strong\u003e，或称桩代码，是指用来代替关联代码或者未实现代码的代码。如果函数 B 用 B1 来代替，那么，B 称为原函数，B1 称为桩函数。打桩就是编写或生成桩代码。\u003c/p\u003e\n\u003ch2\u003egostub\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ego get github.com/prashantv/gostub\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e为一个全局变量打桩\u003c/li\u003e\n\u003cli\u003e为一个函数打桩\u003c/li\u003e\n\u003cli\u003e为一个过程打桩\u003c/li\u003e\n\u003cli\u003e由任意相同或不同的基本场景组合而成\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003efunc \u003cspan class=\"hljs-title class_\"\u003eTestStubMethod\u003c/span\u003e(t *testing.\u003cspan class=\"hljs-property\"\u003eT\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e printStr = \u003cspan class=\"hljs-title function_\"\u003efunc\u003c/span\u003e(val string) string {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e val\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// 针对有参数有返回值的\u003c/span\u003e\n    stubs := gostub.\u003cspan class=\"hljs-title class_\"\u003eStub\u003c/span\u003e(\u0026amp;printStr, \u003cspan class=\"hljs-title function_\"\u003efunc\u003c/span\u003e(val string) string {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;hello,\u0026quot;\u003c/span\u003e + val\n    })\n    defer stubs.\u003cspan class=\"hljs-title class_\"\u003eReset\u003c/span\u003e()\n    fmt.\u003cspan class=\"hljs-title class_\"\u003ePrintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;After stub: \u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eprintStr\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;hhhhh\u0026quot;\u003c/span\u003e))\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e printStr2 = \u003cspan class=\"hljs-title function_\"\u003efunc\u003c/span\u003e(val string) string {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e val\n    }\n    \u003cspan class=\"hljs-comment\"\u003e// StubFunc 第一个参数必须是一个函数变量的指针，该指针指向的必须是一个函数变量，第二个参数为函数 mock 的返回值\u003c/span\u003e\n    stubs2 := gostub.\u003cspan class=\"hljs-title class_\"\u003eStubFunc\u003c/span\u003e(\u0026amp;printStr2, \u003cspan class=\"hljs-string\"\u003e\u0026quot;ddddd,万生世代\u0026quot;\u003c/span\u003e)\n    defer stubs2.\u003cspan class=\"hljs-title class_\"\u003eReset\u003c/span\u003e()\n    fmt.\u003cspan class=\"hljs-title class_\"\u003ePrintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;After stub:\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eprintStr2\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;lalala\u0026quot;\u003c/span\u003e))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003egomonkey\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003egithub.com/agiledragon/gomonkey/v2\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e1、它违反了开闭原则。\n2、运行时必须关闭内连「go test -gcflags=all=-l」。\n3、运行时需要很高的权限，并且不同的硬件需要不同的黑科技实现\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e直接在方法级别上进行 mock\u003cbr\u003e（在运行时通过汇编语句重写可执行文件，将待打桩函数或方法的实现跳转到桩实现）\u003cbr\u003e在编译阶段直接替换掉真的函数代码部分  \u003c/li\u003e\n\u003cli\u003e非线程安全，请勿用于并发测试\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e并且必须加上\u003ccode\u003e\u0026quot;-gcflags=all=-l\u0026quot;\u003c/code\u003e, 避免内联优化(短函数直接被合并不会单独作为一个函数)导致测试失败\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003efunc DoSomething(name string, args ...string) (string, error) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, errors.New(\u003cspan class=\"hljs-string\"\u003e\u0026quot;TODO\u0026quot;\u003c/span\u003e)\n}\n\nfunc TestExec(t *testing.T) {\n    patches := gomonkey.NewPatches()\n    defer patches.Reset()\n    outputExpect := \u003cspan class=\"hljs-string\"\u003e\u0026quot;xxx-vethName100-yyy\u0026quot;\u003c/span\u003e\n    guard := patches.ApplyFunc(DoSomething, func(_ string, _ ...string) (string, error) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e outputExpect, nil\n    })\n    defer guard.Reset()\n    output, err := DoSomething(\u003cspan class=\"hljs-string\"\u003e\u0026quot;asd\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;1\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;2\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;3\u0026quot;\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e.Nil(t, err)\n    \u003cspan class=\"hljs-keyword\"\u003eassert\u003c/span\u003e.Equal(t, outputExpect, output)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003ehttp测试\u003c/h2\u003e\n\u003cp\u003e在 web 项目中，大多接口是处理 http 请求（post、get 之类的），在测试环境中，是访问不到它发起的 get 请求的 url 的，此时就可以模拟 http 请求来写测试。可以利用官方自带的 http 包来进行模拟请求。\u003c/p\u003e\n\u003ch2\u003esql测试\u003c/h2\u003e\n\u003cp\u003e模拟任何实现了 sql/driver 接口的 db 驱动，无需关注 db 连接。\u003c/p\u003e\n\u003ch1\u003e性能调优\u003c/h1\u003e\n\u003cp\u003e使用go内置的工具pprof即可分析程序运行状态的整体情况\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eallocs\u003c/th\u003e\n\u003cth\u003e内存分配情况的采样信息\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eblocks\u003c/td\u003e\n\u003ctd\u003e阻塞操作情况的采样信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecmdline\u003c/td\u003e\n\u003ctd\u003e程序启动命令参数\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egoroutine\u003c/td\u003e\n\u003ctd\u003e所有协程的堆栈信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eheap\u003c/td\u003e\n\u003ctd\u003e堆上的内存分配情况\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emutex\u003c/td\u003e\n\u003ctd\u003e锁竞争情况的采样信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eprofile\u003c/td\u003e\n\u003ctd\u003ecpu占用情况的采样信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ethreadcreate\u003c/td\u003e\n\u003ctd\u003e系统线程创建情况的采样信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etrace\u003c/td\u003e\n\u003ctd\u003e程序运行跟踪信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003eruntim/pprof: 手动调用，一般在函数入口中\u003c/li\u003e\n\u003cli\u003enet/http/pprof: 用于web系统中，不过只是对runtime/pprof的简单封装\u003c/li\u003e\n\u003cli\u003egin-contrib提供了对net/http/pprof的封装，能够在gin中使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e需要注意的是，profile所显示的时间明显小于接口调用的时间，是因为profile只能够分析cpu的耗时，无法计算io情况(因为io不会占用cpu)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 下载cpu profile，默认从当前开始收集30s的cpu使用情况，需要等待30s\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/profile\u003c/span\u003e   \u003cspan class=\"hljs-comment\"\u003e# 30-second CPU profile\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/profile?seconds=120\u003c/span\u003e     \u003cspan class=\"hljs-comment\"\u003e# wait 120s\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 下载heap profile\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/heap\u003c/span\u003e      \u003cspan class=\"hljs-comment\"\u003e# heap profile\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 下载goroutine profile\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/goroutine\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# goroutine profile\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 下载block profile\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/block\u003c/span\u003e     \u003cspan class=\"hljs-comment\"\u003e# goroutine blocking profile\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 下载mutex profile\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etool\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epprof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ehttp://localhost:6060/debug/pprof/mutex\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003etrace\u003c/h2\u003e\n\u003cp\u003etrace工具，用于查看整个周期内发生的事件，指定的Goroutines何时执行、执行 了多长时间、什么时候陷入了堵塞、什么时候解除了堵塞、GC如何影 响单个Goroutine的执行、STW中断花费的时间是否太长等 。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e协程的创建、开始和结束\u003c/li\u003e\n\u003cli\u003e协程的堵塞-系统调用、通道、锁\u003c/li\u003e\n\u003cli\u003e网络I/O相关事件\u003c/li\u003e\n\u003cli\u003e系统调用事件\u003c/li\u003e\n\u003cli\u003e垃圾回收相关事件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;runtime/trace\u0026quot;\u003c/span\u003e\n\ntrace.\u003cspan class=\"hljs-title class_\"\u003eStart\u003c/span\u003e(f)\n\ndefer trace.\u003cspan class=\"hljs-title class_\"\u003eStop\u003c/span\u003e()\n\n\u003cspan class=\"hljs-comment\"\u003e// or use net/pprof\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// curl -o trace.out http.../debug/pprof/trace?second=20\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 然后使用go tool trace trace.out进行分析\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在trace的初始阶段需要首先STW，然后获取协程的快照、状态、栈帧信息，然后开启GC重新启动所有协程。go源码中对于关键事件都加了判断是否开启了trace，开启后，触发这些事件时都会写入。\u003c/p\u003e\n\u003cp\u003e关键的事件包括协程的生命周期、协程堵塞、网络I/O、系统 调用、垃圾回收等，根据事件的不同，可能保存和此事件相关的不同 数量的参数及栈追踪数据。每个逻辑处理器P都有一个缓存 (p.tracebuf)，用于存储已经被序列化为字节的事件(Event) 。每个p的tracebuf都有限度，超过之后会转移到全局链表。\u003c/p\u003e\n\u003cp\u003etrace工具会新开一个协程专门用于读取全局trace上的信息， 此时全局的事件对象已经是序列化之后的字节数组，直接添加到文件 中即可。另外，访问全局trace缓存需要加锁，当没有可以访问的对象 时，读取协程会陷入休眠状态 。\u003c/p\u003e\n\u003cp\u003e当指定的事件到期后结束trace任务程序再次进入STW，刷新逻辑处理器P上的tracebuf缓存\u003c/p\u003e\n\u003ch2\u003epyroscope\u003c/h2\u003e\n\u003cp\u003e基于pprof数据的可视化工具，提供上报和拉取两种模式\u003c/p\u003e\n\u003cp\u003e支持多种语言\u003c/p\u003e\n\u003cp\u003e可以将各个服务的运行数据集中起来，更利于管理\u003c/p\u003e\n\u003cp\u003e不过只能获取到当前时间点的内存分配情况、当前使用的内存情况，以及CPU耗时等\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003e另外，除了无法对协程数、mutex等进行分析\u003c/del\u003e, 又错怪了😹，pyroscope支持的分析维度包括(cpu、inuse_objects、alloc_objects、inuse_space，alloc_space, goroutines、mutex_duration、block_count、block_duration，这里面除了pprof，应该还用了trace包里面的数据)\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003e绘制的时间曲线没有具体的数值，也无法查看具体时间点下的数据情况\u003c/del\u003e(错怪了，时间区间选择可以用鼠标滑动选择，无法点击某个特定的柱形结构)\u003c/p\u003e\n\u003ch2\u003e排查CPU占用过高\u003c/h2\u003e\n\u003cp\u003etop命令确认\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego tool pprof http://localhost:6060/debug/pprof/profile\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e进入交互使用top查看CPU占用较高的调用\u003c/p\u003e\n\u003cp\u003etop\u003c/p\u003e\n\u003cp\u003e使用list 名字 查看调用的具体位置\u003c/p\u003e\n\u003cp\u003elist Eat\u003c/p\u003e\n\u003cp\u003e如果安装了graphviz工具，使用web命令之后能够在web界面上看到调用链路图\u003c/p\u003e\n\u003cp\u003ebrew install graphviz\u003c/p\u003e\n\u003cimg src=\"/images/blogs/cpu-web.png\" /\u003e\n\n\u003cp\u003e修复问题代码继续后面的操作\u003c/p\u003e\n\u003ch2\u003e排查内存占用过高\u003c/h2\u003e\n\u003cp\u003e修复代码中的死循环，再次使用top会发现CPU占用率下来了\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego tool pprof http://localhost:6060/debug/pprof/heap\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e再次使用top、list定位到问题代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-attr\"\u003eTotal:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e50GB\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003eROUTINE\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e========================\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e/Users/dengronghui/Documents/Apps/public/handbook/Golang/go-pprof-practice-master/animal/muridae/mouse/mouse.go\u003c/span\u003e\n    \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e50GB\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e50GB\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e(flat,\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecum)\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e99.90\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e%\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eof\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTotal\u003c/span\u003e\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-attr\"\u003e45:\u003c/span\u003e\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e46\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:func\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e(m\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e*Mouse)\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSteal()\u003c/span\u003e {\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-attr\"\u003e47:\u003c/span\u003e\t\u003cspan class=\"hljs-string\"\u003elog.Println(m.Name()\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;steal\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-attr\"\u003e48:\u003c/span\u003e\t\u003cspan class=\"hljs-string\"\u003emax\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e:=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003econstant.Gi\u003c/span\u003e\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-attr\"\u003e49:\u003c/span\u003e\t\u003cspan class=\"hljs-string\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elen(m.buffer)*constant.Mi\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emax\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003e1.50GB     1.50GB     50:\u003c/span\u003e\t\t\u003cspan class=\"hljs-string\"\u003em.buffer\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eappend(m.buffer\u003c/span\u003e, [\u003cspan class=\"hljs-string\"\u003econstant.Mi\u003c/span\u003e]\u003cspan class=\"hljs-string\"\u003ebyte\u003c/span\u003e{}\u003cspan class=\"hljs-string\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-attr\"\u003e51:\u003c/span\u003e\t}\n         \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e          \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e52\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同样可以使用web可视化展示\u003c/p\u003e\n\u003ch2\u003e排查频繁内存回收\u003c/h2\u003e\n\u003cp\u003e获取程序运行时的GC日志\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egc 1 @0.003s 7%: 0.022+2.1+0.002 ms clock, 0.18+1.1/1.9/3.0+0.019 ms cpu, 4-\u0026gt;4-\u0026gt;3 MB, 5 MB goal, 8 P\ngc 2 @0.018s 3%: 0.009+1.8+0.001 ms clock, 0.073+0.096/2.2/0.16+0.013 ms cpu, 7-\u0026gt;7-\u0026gt;6 MB, 8 MB goal, 8 P\ngc 3 @0.089s 0%: 0.022+0.92+0.013 ms clock, 0.17+0.095/1.0/0.75+0.10 ms cpu, 16-\u0026gt;16-\u0026gt;14 MB, 17 MB goal, 8 P\ngc 4 @0.489s 0%: 0.023+1.5+0.014 ms clock, 0.18+0/2.4/1.1+0.11 ms cpu, 29-\u0026gt;29-\u0026gt;15 MB, 30 MB goal, 8 P\ngc 1 @0.003s 1%: 0.013+0.55+0.002 ms clock, 0.013+0.22/0.17/0+0.002 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\ngc 2 @3.020s 0%: 0.070+0.56+0.002 ms clock, 0.070+0.17/0.20/0+0.002 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\ngc 3 @6.027s 0%: 0.15+0.98+0.003 ms clock, 0.15+0.36/0.36/0+0.003 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\ngc 4 @9.034s 0%: 0.10+0.63+0.002 ms clock, 0.10+0.16/0.23/0+0.002 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\ngc 5 @12.040s 0%: 0.070+0.53+0.002 ms clock, 0.070+0.23/0.19/0+0.002 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\ngc 6 @15.047s 0%: 0.11+0.66+0.002 ms clock, 0.11+0.23/0.27/0+0.002 ms cpu, 16-\u0026gt;16-\u0026gt;0 MB, 17 MB goal, 1 P\n\u003c/code\u003e\u003c/pre\u003e\u003cimg src=\"/images/blogs/gc_info.png\" /\u003e\n\n\u003cp\u003e每次gc都从16MB释放到0MB，说明程序在不断的声明然后释放内存\u003c/p\u003e\n\u003cp\u003e接下来使用 pprof 排查时，我们在乎的不是什么地方在占用大量内存，而是什么地方在不停地申请内\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego tool pprof http://localhost:6060/debug/pprof/allocs\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003e排查协程泄漏\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ego tool pprof http://localhost:6060/debug/pprof/goroutine\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e同样使用top、list、web即可定位到\u003c/p\u003e\n\u003ch2\u003e排查锁的争用\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ego tool pprof http://localhost:6060/debug/pprof/mutex\u003c/code\u003e\u003c/p\u003e\n","frontMatter":{"readingTime":{"text":"21 min read","minutes":20.295,"time":1217700,"words":4059},"slug":"golang工程化总览","fileName":"golang工程化总览.md","title":"golang工程化纵览","date":"2022-07-03T00:00:00.000Z","tags":["Golang"],"draft":false,"summary":"golang工程化所用到的工具概览"}},"prev":{"title":"go-zero微服务实践","date":"2022-06-20T00:00:00.000Z","tags":["实践","云原生"],"draft":false,"summary":"微服务简介以及go-zero如何落地","slug":"go-zero微服务实践"},"next":{"title":"容器之间的网络模式","date":"2022-07-04T00:00:00.000Z","tags":["容器"],"draft":false,"summary":"容器之间的网络模式简介","slug":"容器之间的网络模式"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["golang工程化总览"]},"buildId":"qwylQn0rAYfx_DG8FLkaO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>