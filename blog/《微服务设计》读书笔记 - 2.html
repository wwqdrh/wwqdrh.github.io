<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>微服务设计2</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="description" content="微服务设计读书笔记-第3-4章"/><meta property="og:type"/><meta property="og:title" content="微服务设计2"/><meta property="og:description" content="微服务设计读书笔记-第3-4章"/><meta property="og:url" content="https://wwqdrh.github.io/undefined"/><meta name="keywords" content="wwqdrh技术博客"/><meta property="og:locale" content="zh-CN"/><meta property="og:image" content="https://wwqdrh.github.io"/><meta name="twitter:title" content="微服务设计2"/><meta name="twitter:description" content="微服务设计读书笔记-第3-4章"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://wwqdrh.github.io"/><link rel="stylesheet" href="/assets/mdrender/editor-render.css"/><meta name="next-head-count" content="17"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><script src="/assets/analizy/clarity.js"></script><link rel="preload" href="/_next/static/media/d83e92f0af8b17e4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ed42d1b51efd45f6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/fba9d678ff638e59-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e52907b750a6f61e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9031250013752d4b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb9adf802b0a60eb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/81b352a4d7a000ae-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/41b9b3ece820718f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d587d1c112526568-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/869c7de7c781f904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/869c7de7c781f904.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-fbe37f60a09a330b.js" defer=""></script><script src="/_next/static/chunks/main-082d90b1269d95f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-494ee9c4b0594b31.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-222bf60d0a2bf3df.js" defer=""></script><script src="/_next/static/PMB5qMppIrri5HN2Gb314/_buildManifest.js" defer=""></script><script src="/_next/static/PMB5qMppIrri5HN2Gb314/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global c86wz">body{margin:0;padding:0;color:hsl(0, 0%, 9.0%);background-color:hsl(0, 0%, 97.3%);font-family:'__pretendard_6bb8e5','__pretendard_Fallback_6bb8e5';}*{-webkit-print-color-scheme:light;color-scheme:light;box-sizing:border-box;}h1,h2,h3,h4,h5,h6{margin:0;font-weight:inherit;font-style:inherit;}a{all:unset;cursor:pointer;}ul{padding:0;}button{all:unset;cursor:pointer;}input{all:unset;box-sizing:border-box;}textarea{border:none;background-color:transparent;font-family:inherit;padding:0;outline:none;resize:none;color:inherit;}hr{width:100%;border:none;margin:0;border-top:1px solid hsl(0, 0%, 88.7%);}</style><style data-emotion="css 1q70a33">.css-1q70a33{z-index:30;position:-webkit-sticky;position:sticky;top:0;background-color:hsl(0, 0%, 97.3%);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);}.css-1q70a33 .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:3rem;margin:0 auto;}@media (min-width: 768px){.css-1q70a33 .container[data-full-width="true"]{padding-left:6rem;padding-right:6rem;}}.css-1q70a33 .container .nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.75rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1q70a33 .container .mid{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1.25rem;padding-right:1.25rem;border-radius:1rem;outline-style:none;width:50%;background-color:hsl(0, 0%, 93.0%);}</style><div class="py-2 css-1q70a33"><div data-full-width="false" class="container"><a aria-label="wwqdrh" class="css-0" href="/">wwqdrh</a><input class="mid" type="text" placeholder="Search Keyword..." value=""/><div class="nav"><style data-emotion="css 1nw6zn9">.css-1nw6zn9{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-1nw6zn9 ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1nw6zn9 ul li{display:block;margin-left:1rem;color:hsl(0, 0%, 43.5%);}</style><div class="css-1nw6zn9"><ul><li><a target="_blank" href="https://space.bilibili.com/538676331">B站</a></li></ul></div><style data-emotion="css 1h5x3dy">.css-1h5x3dy{cursor:pointer;}</style><div class="css-1h5x3dy"><style data-emotion="css p95608">.css-p95608{font-family:'__Noto_Color_Emoji_be1378','__Noto_Color_Emoji_Fallback_be1378',Apple Color Emoji;font-weight:400;font-style:normal;}</style><span class="css-p95608">☀️</span></div></div></div></div><style data-emotion="css lomkhl">.css-lomkhl{margin:0 auto;width:100%;padding:0 3rem;}</style><main class="css-lomkhl"><div class="divide-y bg-white dark:bg-gray-700 p-6 shadow-lg rounded-lg mt-3 divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="max-w-none pt-10 pb-8 prose dark:prose-dark"><div><h1>如何建模服务</h1>
<p>本章围绕着如何定义服务，以及如何划分服务上下文与边界展开</p>
<p>衡量一个服务是否是好服务的两个标准</p>
<ul>
<li>松耦合: 独立修改及部署单个服务而不需要修改系统的其他部分，需要尽可能少的知道与之协作的那些服务的信息。要尽可能的知道与之协作的那些服务的信息，限制两个服务之间不同调用形式的数量，因为除了潜在的性能问题之外，过度的通信可能会导致紧耦合</li>
<li>高内聚：实现高内聚为了避免发布修改时需要同时发布多个微服务，另外，找到问题域的边界就可以确保相关的行为能放在同一个地方，并且他们会和其他边界以尽量松耦合的形式进行通信</li>
</ul>
<blockquote>
<p>《领域驱动设计》Eric Evans: 任何一个给定的领域都包含多个限界上下文，每个限界上下文中的模型分成两部分，一部分不需要与外部通信，另一部分则需要，每个上下文都有明确的接口，该接口决定了他会暴露哪些模型给其他上下文</p>
</blockquote>
<p>”细胞之所以会存在，是因为细胞膜定义了什么在细胞内，什么在细胞外，并且确定了什么物质可以通过细胞膜“ (绝了😹)</p>
<p>做到服务边界与领域限界上下文保持一致，使用微服务可以很好地表示这些限界上下文</p>
<br/>

<p>文中提到如果无法清晰的划分服务与模型，那么最好先使用单体架构，过早的将一个系统划分为错误的微服务结构代价很高</p>
<br/>

<p>但是即使分得再明确，也存在一些共享模型，拿书中的例子就是，仓库部分的库存信息，财务部门是需要知道的，这里的处理就是仅暴露模型的部分，对于模型来说分成内部和外部表示方法。不仅如此，这些共享模型在不同的领域之间往往代表着不同的名字。在思考这些上下文时，不应该从共享数据的角度来考虑，而是从这些上下文能够提供的功能来考虑</p>
<blockquote>
<p>通过共享特定的模型而不是整个内部表示，可以避免潜在的紧耦合</p>
</blockquote>
<p>划分上下文边界时，首先考虑比较大的，粗粒度的上下文，当发现合适的缝隙后，再进一步划分出那些嵌套的上下文</p>
<p>如果把系统分解成为限界上下文来表示领域的话，那么对于某个功能需要做的修改，就更倾向于局限在一个单独的微服务边界之内，这样就可以减小修改的范围，更快速的部署。</p>
<h1>集成</h1>
<p>1、无论如何避免数据库集成
2、理解REST和RPC之间的取舍，但总是使用REST作为请求/响应模式的起点
3、相比编排，优先选择协同
4、避免破坏性修改，理解Postel法则（鲁棒性原则: 系统中每个模块都要宽进严出，对自己发送的东西要严格，对接收的东西要宽容）</p>
<p>好的集成可以使得微服务保持自治性，能够独立地修改和发布它们</p>
<p>好的通信协议的要求</p>
<ul>
<li>避免破坏性修改，例如发送方添加了一个字段，接收方要做到不受影响（当然修改除外😹）</li>
<li>技术无关性</li>
<li>消费端要易于接入</li>
<li>隐藏内部实现细节，否则一个消费方依赖这个细节会导致耦合度增加</li>
</ul>
<p>选择服务之间的设计模式有两种，编排和协作</p>
<p>编排模式，容器出现承担太多工作的上帝服务，而其他的变成了贫血的CRUD服务</p>
<p>协作模式, 异步非方式，服务自己订阅事件并处理响应的事件，不需要中间节点进行编排调度，好处是能够解耦合，但是还是需要相匹配的监控系统才能保证服务确实可靠的执行完成</p>
<p>使用rpc时不要过度抽象，不要隐藏网络因素造成的问题</p>
</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"\u003ch1\u003e如何建模服务\u003c/h1\u003e\n\u003cp\u003e本章围绕着如何定义服务，以及如何划分服务上下文与边界展开\u003c/p\u003e\n\u003cp\u003e衡量一个服务是否是好服务的两个标准\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e松耦合: 独立修改及部署单个服务而不需要修改系统的其他部分，需要尽可能少的知道与之协作的那些服务的信息。要尽可能的知道与之协作的那些服务的信息，限制两个服务之间不同调用形式的数量，因为除了潜在的性能问题之外，过度的通信可能会导致紧耦合\u003c/li\u003e\n\u003cli\u003e高内聚：实现高内聚为了避免发布修改时需要同时发布多个微服务，另外，找到问题域的边界就可以确保相关的行为能放在同一个地方，并且他们会和其他边界以尽量松耦合的形式进行通信\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e《领域驱动设计》Eric Evans: 任何一个给定的领域都包含多个限界上下文，每个限界上下文中的模型分成两部分，一部分不需要与外部通信，另一部分则需要，每个上下文都有明确的接口，该接口决定了他会暴露哪些模型给其他上下文\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e”细胞之所以会存在，是因为细胞膜定义了什么在细胞内，什么在细胞外，并且确定了什么物质可以通过细胞膜“ (绝了😹)\u003c/p\u003e\n\u003cp\u003e做到服务边界与领域限界上下文保持一致，使用微服务可以很好地表示这些限界上下文\u003c/p\u003e\n\u003cbr/\u003e\n\n\u003cp\u003e文中提到如果无法清晰的划分服务与模型，那么最好先使用单体架构，过早的将一个系统划分为错误的微服务结构代价很高\u003c/p\u003e\n\u003cbr/\u003e\n\n\u003cp\u003e但是即使分得再明确，也存在一些共享模型，拿书中的例子就是，仓库部分的库存信息，财务部门是需要知道的，这里的处理就是仅暴露模型的部分，对于模型来说分成内部和外部表示方法。不仅如此，这些共享模型在不同的领域之间往往代表着不同的名字。在思考这些上下文时，不应该从共享数据的角度来考虑，而是从这些上下文能够提供的功能来考虑\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e通过共享特定的模型而不是整个内部表示，可以避免潜在的紧耦合\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e划分上下文边界时，首先考虑比较大的，粗粒度的上下文，当发现合适的缝隙后，再进一步划分出那些嵌套的上下文\u003c/p\u003e\n\u003cp\u003e如果把系统分解成为限界上下文来表示领域的话，那么对于某个功能需要做的修改，就更倾向于局限在一个单独的微服务边界之内，这样就可以减小修改的范围，更快速的部署。\u003c/p\u003e\n\u003ch1\u003e集成\u003c/h1\u003e\n\u003cp\u003e1、无论如何避免数据库集成\n2、理解REST和RPC之间的取舍，但总是使用REST作为请求/响应模式的起点\n3、相比编排，优先选择协同\n4、避免破坏性修改，理解Postel法则（鲁棒性原则: 系统中每个模块都要宽进严出，对自己发送的东西要严格，对接收的东西要宽容）\u003c/p\u003e\n\u003cp\u003e好的集成可以使得微服务保持自治性，能够独立地修改和发布它们\u003c/p\u003e\n\u003cp\u003e好的通信协议的要求\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e避免破坏性修改，例如发送方添加了一个字段，接收方要做到不受影响（当然修改除外😹）\u003c/li\u003e\n\u003cli\u003e技术无关性\u003c/li\u003e\n\u003cli\u003e消费端要易于接入\u003c/li\u003e\n\u003cli\u003e隐藏内部实现细节，否则一个消费方依赖这个细节会导致耦合度增加\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e选择服务之间的设计模式有两种，编排和协作\u003c/p\u003e\n\u003cp\u003e编排模式，容器出现承担太多工作的上帝服务，而其他的变成了贫血的CRUD服务\u003c/p\u003e\n\u003cp\u003e协作模式, 异步非方式，服务自己订阅事件并处理响应的事件，不需要中间节点进行编排调度，好处是能够解耦合，但是还是需要相匹配的监控系统才能保证服务确实可靠的执行完成\u003c/p\u003e\n\u003cp\u003e使用rpc时不要过度抽象，不要隐藏网络因素造成的问题\u003c/p\u003e\n","frontMatter":{"readingTime":{"text":"6 min read","minutes":5.95,"time":357000,"words":1190},"slug":"《微服务设计》读书笔记 - 2","fileName":"《微服务设计》读书笔记 - 2.md","title":"微服务设计2","date":"2022-08-02T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第3-4章"}},"prev":{"title":"微服务设计1","date":"2022-07-31T00:00:00.000Z","tags":["读书笔记"],"category":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第1-2章","slug":"《微服务设计》读书笔记 - 1"},"next":{"title":"微服务设计3","date":"2022-08-05T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第5-6章","slug":"《微服务设计》读书笔记 - 3"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["《微服务设计》读书笔记 - 2"]},"buildId":"PMB5qMppIrri5HN2Gb314","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>