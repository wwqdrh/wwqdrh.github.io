<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>微服务设计4</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="description" content="微服务设计读书笔记-第7-8-9-10-11章"/><meta property="og:type"/><meta property="og:title" content="微服务设计4"/><meta property="og:description" content="微服务设计读书笔记-第7-8-9-10-11章"/><meta property="og:url" content="https://wwqdrh.github.io/undefined"/><meta name="keywords" content="wwqdrh技术博客"/><meta property="og:locale" content="zh-CN"/><meta property="og:image" content="https://wwqdrh.github.io"/><meta name="twitter:title" content="微服务设计4"/><meta name="twitter:description" content="微服务设计读书笔记-第7-8-9-10-11章"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://wwqdrh.github.io"/><link rel="stylesheet" href="/assets/mdrender/editor-render.css"/><meta name="next-head-count" content="17"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><script src="/assets/analizy/clarity.js"></script><link rel="preload" href="/_next/static/media/d83e92f0af8b17e4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e52907b750a6f61e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ed42d1b51efd45f6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9031250013752d4b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/fba9d678ff638e59-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb9adf802b0a60eb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/81b352a4d7a000ae-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/41b9b3ece820718f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d587d1c112526568-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/869c7de7c781f904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/869c7de7c781f904.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-fbe37f60a09a330b.js" defer=""></script><script src="/_next/static/chunks/main-082d90b1269d95f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ebc472ae118a2be0.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-222bf60d0a2bf3df.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_buildManifest.js" defer=""></script><script src="/_next/static/qwylQn0rAYfx_DG8FLkaO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global c86wz">body{margin:0;padding:0;color:hsl(0, 0%, 9.0%);background-color:hsl(0, 0%, 97.3%);font-family:'__pretendard_6bb8e5','__pretendard_Fallback_6bb8e5';}*{-webkit-print-color-scheme:light;color-scheme:light;box-sizing:border-box;}h1,h2,h3,h4,h5,h6{margin:0;font-weight:inherit;font-style:inherit;}a{all:unset;cursor:pointer;}ul{padding:0;}button{all:unset;cursor:pointer;}input{all:unset;box-sizing:border-box;}textarea{border:none;background-color:transparent;font-family:inherit;padding:0;outline:none;resize:none;color:inherit;}hr{width:100%;border:none;margin:0;border-top:1px solid hsl(0, 0%, 88.7%);}</style><style data-emotion="css 1q70a33">.css-1q70a33{z-index:30;position:-webkit-sticky;position:sticky;top:0;background-color:hsl(0, 0%, 97.3%);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);}.css-1q70a33 .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:3rem;margin:0 auto;}@media (min-width: 768px){.css-1q70a33 .container[data-full-width="true"]{padding-left:6rem;padding-right:6rem;}}.css-1q70a33 .container .nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.75rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1q70a33 .container .mid{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1.25rem;padding-right:1.25rem;border-radius:1rem;outline-style:none;width:50%;background-color:hsl(0, 0%, 93.0%);}</style><div class="py-2 css-1q70a33"><div data-full-width="false" class="container"><a aria-label="wwqdrh" class="css-0" href="/">wwqdrh</a><input class="mid" type="text" placeholder="Search Keyword..." value=""/><div class="nav"><style data-emotion="css 1nw6zn9">.css-1nw6zn9{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-1nw6zn9 ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1nw6zn9 ul li{display:block;margin-left:1rem;color:hsl(0, 0%, 43.5%);}</style><div class="css-1nw6zn9"><ul><li><a target="_blank" href="https://space.bilibili.com/538676331">B站</a></li></ul></div><style data-emotion="css 1h5x3dy">.css-1h5x3dy{cursor:pointer;}</style><div class="css-1h5x3dy"><style data-emotion="css p95608">.css-p95608{font-family:'__Noto_Color_Emoji_be1378','__Noto_Color_Emoji_Fallback_be1378',Apple Color Emoji;font-weight:400;font-style:normal;}</style><span class="css-p95608">☀️</span></div></div></div></div><style data-emotion="css lomkhl">.css-lomkhl{margin:0 auto;width:100%;padding:0 3rem;}</style><main class="css-lomkhl"><div class="divide-y bg-white dark:bg-gray-700 p-6 shadow-lg rounded-lg mt-3 divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="max-w-none pt-10 pb-8 prose dark:prose-dark"><div><h1>测试</h1>
<ul>
<li>优化快速反馈，并相应地使用不同类型的测试</li>
<li>尽可能使用消费者驱动的契约测试来替换端到端测试</li>
<li>使用消费者驱动的契约测试，提供团队之间的对话要点</li>
<li>尝试理解投入更多的努力测试与更快地在生产环境发现问题之间的权衡</li>
</ul>
<blockquote>
<p>在《敏捷软件测试》中，提出了对于不同测试类型分类的测试象限，其中单元测试、非功能测试是面向技术开发人员的。</p>
</blockquote>
<p>这一章节将测试按照金字塔结构分成三层，从上往下依次为用户界面测试、服务测试、单元测试，越往下应该测试得更快以及隔离性更好，一个好的法则是下面一层的测试数量比上面一层多一个数量级。</p>
<p>一个服务测试用来测试其中一个单独服务的功能，为了达到隔离功能，需要外部合作者配合打桩</p>
<blockquote>
<p>打桩是指为待测试的服务创建一些有着预设响应的服务</p>
</blockquote>
<p>与打桩相比mock还会进一步校验请求本身是否被正确调用</p>
<p>在团队中如何维护这些测试套件，文中的观点是，共享端到端测试套件的代码权，但同时对测试套件联合负责。团队可以随意提交测试到这个但是实现服务的团队需要负责维护这些提交是否正确。</p>
<p>CDC，消费者驱动契约，定义服务的消费者期望，这些最终会变成对生产者运行的测试代码。并且CDC同样作为生产者部署是的单元测试一部分，保证这个期望不会被破坏以及消费端不会产生异常</p>
<p>上线后的测试也同样重要，例如通过蓝绿部署或者金丝雀部署(一点点调大流量到新版本)，保证如果错误，能够迅速切回到旧版本</p>
<p>平均修复时间有时比平均故障间隔时间更有意义，减少修复时间即尽快回滚加上良好的监控</p>
<h1>监控</h1>
<p>对于服务来说</p>
<ul>
<li>请求响应时间，以及更高要求的指标，例如跟踪错误率</li>
<li>下游服务的健康状态、响应时间等</li>
<li>标准化如何收集以及存储指标</li>
</ul>
<p>对于系统而言</p>
<ul>
<li>CPU、网络、磁盘等系统级的指标</li>
<li>考虑如何存储以及满足足够长时间的数据</li>
</ul>
<p>一个观点，不要忽略任何信息，尽快捕获并存储，搭建好监控平台，比真正出现问题确无从排查更好</p>
<h1>安全</h1>
<p>一旦你了解系统不同部分的威胁级别，就可以知道什么时候需要考虑传输中的安全，什么时候需要考虑静态安全，或根本不需要考虑</p>
<p>SSO单点登录，访问资源时给定位到身份提供者那里验证省份，确认成功拿到票据，之后通过票据就能够访问资源</p>
<p>细粒度的授权</p>
<p>https</p>
<p>不要自己发明加密算法</p>
<h1>康威定理</h1>
<p>任何组织在设计一套系统时，所交付的设计方案在结构上都与该组织的沟通结构保持一致</p>
<p>康威定理强调了试图让系统设计跟组织结构不匹配所导致的危险</p>
<h1>规模化微服务</h1>
<p>规模化后，故障将成为必然事件</p>
<p>弄清楚每个故障的影响，并弄清楚如何恰当地降级功能</p>
<p>处理系统缓慢比处理系统快速失败困难的多，所以为了避免这种情况，正确的设置超时，实现舱壁隔离不同的连接池，并实现断路器，以便在第一时间避免给一个不健康的系统发送调用</p>
<p>混沌测试，模拟故障发生，演练如何应对这种情况</p>
<p>如果操作是幂等的，可以重复多次调用，而不必担心有什么不利影响。通过添加更多信息来标识是同一个请求</p>
<p>对worker、数据库等进行扩展，负载均衡，加大处理能力</p>
<p>CAP定理: 一致性、可用性、分区容忍性，最多只能保证其中的两个。</p>
<ul>
<li>最终一致的AP系统</li>
<li>很难实现和扩展的CP系统</li>
<li>不存在CA，因为容忍分区，就代表着不能跨网络运行，即在本地运行一个单独的进程，在分布式系统是不存在的。</li>
</ul>
<p>服务注册与发现: 高度动态的环境发现节点的方法，包括服务注册和一些集中的注册表</p>
<p>文档服务: 描述一个服务有什么用处，确保文档总是和最新的微服务API同步，swagger、hal</p>
<p>hal可以在任何给定的接口上查看有哪些功能，同时健康检查页面和单个服务的健康状态</p>
<h1>总结</h1>
<p>微服务，自治的小服务，原则</p>
<p>1、围绕业务概念建模
2、自动化的文化
3、隐藏内部的实现细节
4、一切都去中心化
5、独立部署
6、隔离失败
7、高度可观察</p>
</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"\u003ch1\u003e测试\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e优化快速反馈，并相应地使用不同类型的测试\u003c/li\u003e\n\u003cli\u003e尽可能使用消费者驱动的契约测试来替换端到端测试\u003c/li\u003e\n\u003cli\u003e使用消费者驱动的契约测试，提供团队之间的对话要点\u003c/li\u003e\n\u003cli\u003e尝试理解投入更多的努力测试与更快地在生产环境发现问题之间的权衡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在《敏捷软件测试》中，提出了对于不同测试类型分类的测试象限，其中单元测试、非功能测试是面向技术开发人员的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这一章节将测试按照金字塔结构分成三层，从上往下依次为用户界面测试、服务测试、单元测试，越往下应该测试得更快以及隔离性更好，一个好的法则是下面一层的测试数量比上面一层多一个数量级。\u003c/p\u003e\n\u003cp\u003e一个服务测试用来测试其中一个单独服务的功能，为了达到隔离功能，需要外部合作者配合打桩\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e打桩是指为待测试的服务创建一些有着预设响应的服务\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e与打桩相比mock还会进一步校验请求本身是否被正确调用\u003c/p\u003e\n\u003cp\u003e在团队中如何维护这些测试套件，文中的观点是，共享端到端测试套件的代码权，但同时对测试套件联合负责。团队可以随意提交测试到这个但是实现服务的团队需要负责维护这些提交是否正确。\u003c/p\u003e\n\u003cp\u003eCDC，消费者驱动契约，定义服务的消费者期望，这些最终会变成对生产者运行的测试代码。并且CDC同样作为生产者部署是的单元测试一部分，保证这个期望不会被破坏以及消费端不会产生异常\u003c/p\u003e\n\u003cp\u003e上线后的测试也同样重要，例如通过蓝绿部署或者金丝雀部署(一点点调大流量到新版本)，保证如果错误，能够迅速切回到旧版本\u003c/p\u003e\n\u003cp\u003e平均修复时间有时比平均故障间隔时间更有意义，减少修复时间即尽快回滚加上良好的监控\u003c/p\u003e\n\u003ch1\u003e监控\u003c/h1\u003e\n\u003cp\u003e对于服务来说\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e请求响应时间，以及更高要求的指标，例如跟踪错误率\u003c/li\u003e\n\u003cli\u003e下游服务的健康状态、响应时间等\u003c/li\u003e\n\u003cli\u003e标准化如何收集以及存储指标\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e对于系统而言\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCPU、网络、磁盘等系统级的指标\u003c/li\u003e\n\u003cli\u003e考虑如何存储以及满足足够长时间的数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e一个观点，不要忽略任何信息，尽快捕获并存储，搭建好监控平台，比真正出现问题确无从排查更好\u003c/p\u003e\n\u003ch1\u003e安全\u003c/h1\u003e\n\u003cp\u003e一旦你了解系统不同部分的威胁级别，就可以知道什么时候需要考虑传输中的安全，什么时候需要考虑静态安全，或根本不需要考虑\u003c/p\u003e\n\u003cp\u003eSSO单点登录，访问资源时给定位到身份提供者那里验证省份，确认成功拿到票据，之后通过票据就能够访问资源\u003c/p\u003e\n\u003cp\u003e细粒度的授权\u003c/p\u003e\n\u003cp\u003ehttps\u003c/p\u003e\n\u003cp\u003e不要自己发明加密算法\u003c/p\u003e\n\u003ch1\u003e康威定理\u003c/h1\u003e\n\u003cp\u003e任何组织在设计一套系统时，所交付的设计方案在结构上都与该组织的沟通结构保持一致\u003c/p\u003e\n\u003cp\u003e康威定理强调了试图让系统设计跟组织结构不匹配所导致的危险\u003c/p\u003e\n\u003ch1\u003e规模化微服务\u003c/h1\u003e\n\u003cp\u003e规模化后，故障将成为必然事件\u003c/p\u003e\n\u003cp\u003e弄清楚每个故障的影响，并弄清楚如何恰当地降级功能\u003c/p\u003e\n\u003cp\u003e处理系统缓慢比处理系统快速失败困难的多，所以为了避免这种情况，正确的设置超时，实现舱壁隔离不同的连接池，并实现断路器，以便在第一时间避免给一个不健康的系统发送调用\u003c/p\u003e\n\u003cp\u003e混沌测试，模拟故障发生，演练如何应对这种情况\u003c/p\u003e\n\u003cp\u003e如果操作是幂等的，可以重复多次调用，而不必担心有什么不利影响。通过添加更多信息来标识是同一个请求\u003c/p\u003e\n\u003cp\u003e对worker、数据库等进行扩展，负载均衡，加大处理能力\u003c/p\u003e\n\u003cp\u003eCAP定理: 一致性、可用性、分区容忍性，最多只能保证其中的两个。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e最终一致的AP系统\u003c/li\u003e\n\u003cli\u003e很难实现和扩展的CP系统\u003c/li\u003e\n\u003cli\u003e不存在CA，因为容忍分区，就代表着不能跨网络运行，即在本地运行一个单独的进程，在分布式系统是不存在的。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e服务注册与发现: 高度动态的环境发现节点的方法，包括服务注册和一些集中的注册表\u003c/p\u003e\n\u003cp\u003e文档服务: 描述一个服务有什么用处，确保文档总是和最新的微服务API同步，swagger、hal\u003c/p\u003e\n\u003cp\u003ehal可以在任何给定的接口上查看有哪些功能，同时健康检查页面和单个服务的健康状态\u003c/p\u003e\n\u003ch1\u003e总结\u003c/h1\u003e\n\u003cp\u003e微服务，自治的小服务，原则\u003c/p\u003e\n\u003cp\u003e1、围绕业务概念建模\n2、自动化的文化\n3、隐藏内部的实现细节\n4、一切都去中心化\n5、独立部署\n6、隔离失败\n7、高度可观察\u003c/p\u003e\n","frontMatter":{"readingTime":{"text":"8 min read","minutes":7.26,"time":435600,"words":1452},"slug":"《微服务设计》读书笔记 - 4","fileName":"《微服务设计》读书笔记 - 4.md","title":"微服务设计4","date":"2022-08-07T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第7-8-9-10-11章"}},"prev":{"title":"微服务设计3","date":"2022-08-05T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第5-6章","slug":"《微服务设计》读书笔记 - 3"},"next":{"title":"DevOps实践指南1","date":"2022-08-08T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"Devops实践指南-第1-2章","slug":"《DevOps实践指南》读书笔记 - 1"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["《微服务设计》读书笔记 - 4"]},"buildId":"qwylQn0rAYfx_DG8FLkaO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>