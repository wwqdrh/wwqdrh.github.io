<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>微服务设计3</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="description" content="微服务设计读书笔记-第5-6章"/><meta property="og:type"/><meta property="og:title" content="微服务设计3"/><meta property="og:description" content="微服务设计读书笔记-第5-6章"/><meta property="og:url" content="https://wwqdrh.github.io/undefined"/><meta name="keywords" content="wwqdrh技术博客"/><meta property="og:locale" content="zh-CN"/><meta property="og:image" content="https://wwqdrh.github.io"/><meta name="twitter:title" content="微服务设计3"/><meta name="twitter:description" content="微服务设计读书笔记-第5-6章"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://wwqdrh.github.io"/><link rel="stylesheet" href="/assets/mdrender/editor-render.css"/><meta name="next-head-count" content="17"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><script src="/assets/analizy/clarity.js"></script><link rel="preload" href="/_next/static/media/d83e92f0af8b17e4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ed42d1b51efd45f6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/fba9d678ff638e59-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e52907b750a6f61e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9031250013752d4b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb9adf802b0a60eb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/81b352a4d7a000ae-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/41b9b3ece820718f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d587d1c112526568-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/869c7de7c781f904.css" as="style"/><link rel="stylesheet" href="/_next/static/css/869c7de7c781f904.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-fbe37f60a09a330b.js" defer=""></script><script src="/_next/static/chunks/main-082d90b1269d95f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-494ee9c4b0594b31.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-222bf60d0a2bf3df.js" defer=""></script><script src="/_next/static/xycpTPo5G1XEQLx5GlDdu/_buildManifest.js" defer=""></script><script src="/_next/static/xycpTPo5G1XEQLx5GlDdu/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global c86wz">body{margin:0;padding:0;color:hsl(0, 0%, 9.0%);background-color:hsl(0, 0%, 97.3%);font-family:'__pretendard_6bb8e5','__pretendard_Fallback_6bb8e5';}*{-webkit-print-color-scheme:light;color-scheme:light;box-sizing:border-box;}h1,h2,h3,h4,h5,h6{margin:0;font-weight:inherit;font-style:inherit;}a{all:unset;cursor:pointer;}ul{padding:0;}button{all:unset;cursor:pointer;}input{all:unset;box-sizing:border-box;}textarea{border:none;background-color:transparent;font-family:inherit;padding:0;outline:none;resize:none;color:inherit;}hr{width:100%;border:none;margin:0;border-top:1px solid hsl(0, 0%, 88.7%);}</style><style data-emotion="css 1q70a33">.css-1q70a33{z-index:30;position:-webkit-sticky;position:sticky;top:0;background-color:hsl(0, 0%, 97.3%);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);}.css-1q70a33 .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:3rem;margin:0 auto;}@media (min-width: 768px){.css-1q70a33 .container[data-full-width="true"]{padding-left:6rem;padding-right:6rem;}}.css-1q70a33 .container .nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.75rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1q70a33 .container .mid{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1.25rem;padding-right:1.25rem;border-radius:1rem;outline-style:none;width:50%;background-color:hsl(0, 0%, 93.0%);}</style><div class="py-2 css-1q70a33"><div data-full-width="false" class="container"><a aria-label="wwqdrh" class="css-0" href="/">wwqdrh</a><input class="mid" type="text" placeholder="Search Keyword..." value=""/><div class="nav"><style data-emotion="css 1nw6zn9">.css-1nw6zn9{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-1nw6zn9 ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1nw6zn9 ul li{display:block;margin-left:1rem;color:hsl(0, 0%, 43.5%);}</style><div class="css-1nw6zn9"><ul><li><a target="_blank" href="https://space.bilibili.com/538676331">B站</a></li></ul></div><style data-emotion="css 1h5x3dy">.css-1h5x3dy{cursor:pointer;}</style><div class="css-1h5x3dy"><style data-emotion="css p95608">.css-p95608{font-family:'__Noto_Color_Emoji_be1378','__Noto_Color_Emoji_Fallback_be1378',Apple Color Emoji;font-weight:400;font-style:normal;}</style><span class="css-p95608">☀️</span></div></div></div></div><style data-emotion="css lomkhl">.css-lomkhl{margin:0 auto;width:100%;padding:0 3rem;}</style><main class="css-lomkhl"><div class="divide-y bg-white dark:bg-gray-700 p-6 shadow-lg rounded-lg mt-3 divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="max-w-none pt-10 pb-8 prose dark:prose-dark"><div><h1>分解单块系统</h1>
<blockquote>
<p>小的，增量修改是贯穿整个微服务改造的核心要点，能够清楚会带来什么影响，能够更好的错误的代码，理解如何降低这些错误所造成的影响。从最开始就要养成及时寻找接缝的好习惯，从而减少分割服务的代价，这样才能够在未来遇到新需求时继续演化我们的系统</p>
</blockquote>
<p>从接缝处可以抽取出相对独立的一部分代码，对这部分代码进行修改不会影响系统的其他部分。识别出接缝不仅仅能够清理代码库，更重要的是这些被识别出的接缝可以成为服务的边界</p>
<p>要将单体系统做分离，要考虑接缝是否找到了，应该先将哪个拉出来。最好考虑一下把哪部分代码抽取出来得到的效益最大，而不是为了抽取而抽取</p>
<ul>
<li>改变的速度：对于需要进行大量修改的单元，将其抽离出来单独开发速度大大加快</li>
<li>团队结构</li>
<li>安全</li>
<li>技术</li>
</ul>
<p>另外抽离单元出来还要考虑这部分代码与其他组件的依赖有多乱😹，一般数据库是杂乱依赖的源头</p>
<p>将横跨多个限界上下文的表之间的耦合切断，是一个复杂的问题</p>
<p>1、打破外键依赖
2、共享静态数据：使用静态配置文件或者构建单独的服务(如果很小那就没有必要)
3、共享的可变数据是个大麻烦，对于共享的这部分需要添加一个中间包作为将数据库层的抽象建模层具象化
4、将共享的数据表进行拆分</p>
<p>实施分离时先分离数据库(也是从易于修改和回退的部分做起)</p>
<p>将数据拆分后会遇到的问题就是事务问题，可以将操作加入到队列中通过重试来保证所有的操作都成功执行，保证最终一致性。或者为每一个操作注册补偿事务，当出现失败就进行事务回退，一般这种方案需要额外的事务管理器来管理(例如dtm)</p>
<p>两阶段提交：分为投票和执行阶段，只有所有的组件都告诉事务管理器可以继续执行才会执行这个事务</p>
<p>无论哪种方案都会增加复杂度，如果涉及到分布式事务的，一定要尽量避免将他们放在不同的地方。</p>
<p>通过接口来共享数据，并且为服务增加一些缓存来加快数据获取的速度。对于大数据的接口，为了避免服务端不必要的等待，发起调用的系统可以构造好请求后发给服务端，服务端相应202表示请求已经接收了还在处理，客户端就不断轮询直到201状态，表示请求处理完成了，然后发起调用的系统就可以获取这个数据了。</p>
<h1>部署</h1>
<blockquote>
<p>专注于保持服务能够独立与其他服务进行部署的能力，倾向于一个服务一个代码库，并且都配有自己的CI，基于镜像构建服务，并让整个流程自动化</p>
</blockquote>
<p>没有对代码进行验证的CI不是整整的CI</p>
<p>当持续集成遇上微服务是，需要考虑如何把CI的构建和每个微服务映射起来。</p>
<p>一个CI、一个代码库、多个服务: 如果只修改了某个服务的代码，也会造成整个服务的重新部署</p>
<p>每个服务有独自的CI以及代码库、独立的测试是更好的实践</p>
<p>构建流水线，使得部署过程中某步执行出错能够快速知道而不需要等到所有的都执行完</p>
<p>定制化镜像，为每个服务预装基础服务，例如日志、监控工具</p>
</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"\u003ch1\u003e分解单块系统\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e小的，增量修改是贯穿整个微服务改造的核心要点，能够清楚会带来什么影响，能够更好的错误的代码，理解如何降低这些错误所造成的影响。从最开始就要养成及时寻找接缝的好习惯，从而减少分割服务的代价，这样才能够在未来遇到新需求时继续演化我们的系统\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e从接缝处可以抽取出相对独立的一部分代码，对这部分代码进行修改不会影响系统的其他部分。识别出接缝不仅仅能够清理代码库，更重要的是这些被识别出的接缝可以成为服务的边界\u003c/p\u003e\n\u003cp\u003e要将单体系统做分离，要考虑接缝是否找到了，应该先将哪个拉出来。最好考虑一下把哪部分代码抽取出来得到的效益最大，而不是为了抽取而抽取\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e改变的速度：对于需要进行大量修改的单元，将其抽离出来单独开发速度大大加快\u003c/li\u003e\n\u003cli\u003e团队结构\u003c/li\u003e\n\u003cli\u003e安全\u003c/li\u003e\n\u003cli\u003e技术\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e另外抽离单元出来还要考虑这部分代码与其他组件的依赖有多乱😹，一般数据库是杂乱依赖的源头\u003c/p\u003e\n\u003cp\u003e将横跨多个限界上下文的表之间的耦合切断，是一个复杂的问题\u003c/p\u003e\n\u003cp\u003e1、打破外键依赖\n2、共享静态数据：使用静态配置文件或者构建单独的服务(如果很小那就没有必要)\n3、共享的可变数据是个大麻烦，对于共享的这部分需要添加一个中间包作为将数据库层的抽象建模层具象化\n4、将共享的数据表进行拆分\u003c/p\u003e\n\u003cp\u003e实施分离时先分离数据库(也是从易于修改和回退的部分做起)\u003c/p\u003e\n\u003cp\u003e将数据拆分后会遇到的问题就是事务问题，可以将操作加入到队列中通过重试来保证所有的操作都成功执行，保证最终一致性。或者为每一个操作注册补偿事务，当出现失败就进行事务回退，一般这种方案需要额外的事务管理器来管理(例如dtm)\u003c/p\u003e\n\u003cp\u003e两阶段提交：分为投票和执行阶段，只有所有的组件都告诉事务管理器可以继续执行才会执行这个事务\u003c/p\u003e\n\u003cp\u003e无论哪种方案都会增加复杂度，如果涉及到分布式事务的，一定要尽量避免将他们放在不同的地方。\u003c/p\u003e\n\u003cp\u003e通过接口来共享数据，并且为服务增加一些缓存来加快数据获取的速度。对于大数据的接口，为了避免服务端不必要的等待，发起调用的系统可以构造好请求后发给服务端，服务端相应202表示请求已经接收了还在处理，客户端就不断轮询直到201状态，表示请求处理完成了，然后发起调用的系统就可以获取这个数据了。\u003c/p\u003e\n\u003ch1\u003e部署\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e专注于保持服务能够独立与其他服务进行部署的能力，倾向于一个服务一个代码库，并且都配有自己的CI，基于镜像构建服务，并让整个流程自动化\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e没有对代码进行验证的CI不是整整的CI\u003c/p\u003e\n\u003cp\u003e当持续集成遇上微服务是，需要考虑如何把CI的构建和每个微服务映射起来。\u003c/p\u003e\n\u003cp\u003e一个CI、一个代码库、多个服务: 如果只修改了某个服务的代码，也会造成整个服务的重新部署\u003c/p\u003e\n\u003cp\u003e每个服务有独自的CI以及代码库、独立的测试是更好的实践\u003c/p\u003e\n\u003cp\u003e构建流水线，使得部署过程中某步执行出错能够快速知道而不需要等到所有的都执行完\u003c/p\u003e\n\u003cp\u003e定制化镜像，为每个服务预装基础服务，例如日志、监控工具\u003c/p\u003e\n","frontMatter":{"readingTime":{"text":"6 min read","minutes":5.47,"time":328200,"words":1094},"slug":"《微服务设计》读书笔记 - 3","fileName":"《微服务设计》读书笔记 - 3.md","title":"微服务设计3","date":"2022-08-05T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第5-6章"}},"prev":{"title":"微服务设计2","date":"2022-08-02T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第3-4章","slug":"《微服务设计》读书笔记 - 2"},"next":{"title":"微服务设计4","date":"2022-08-07T00:00:00.000Z","tags":["读书笔记"],"draft":false,"summary":"微服务设计读书笔记-第7-8-9-10-11章","slug":"《微服务设计》读书笔记 - 4"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["《微服务设计》读书笔记 - 3"]},"buildId":"xycpTPo5G1XEQLx5GlDdu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>