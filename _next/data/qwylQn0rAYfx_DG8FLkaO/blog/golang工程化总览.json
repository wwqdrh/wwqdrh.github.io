{"pageProps":{"post":{"mdxSource":"<h1>fmt</h1>\n<p>ä»£ç é£æ ¼æ ¼å¼åŒ– gofmtã€go fmtæ ‡å‡†å·¥å…·</p>\n<h1>vet</h1>\n<p>æ•æ‰å¯èƒ½å‡ºç°çš„é”™è¯¯ æ ‡å‡†å·¥å…· ä¸€èˆ¬æ¥è¯´ç¼–è¾‘å™¨ä¾‹å¦‚vscodeéƒ½å·²ç»é›†æˆäº†è¿™äº›åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬æ£€æµ‹</p>\n<p><code>go vet -all</code></p>\n<p>vetä¸€èˆ¬æ˜¯æ£€æŸ¥</p>\n<pre><code class=\"hljs language-go\">package main \n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;fmt&quot;</span> \n\n<span class=\"hljs-comment\">// Prints out &quot;Super Mario 3&quot; </span>\nfunc <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\"></span>) { \n    game_version :=<span class=\"hljs-number\">3</span> \n    fmt.<span class=\"hljs-title class_\">Printf</span>(<span class=\"hljs-string\">&quot;Super Mario %s\\n&quot;</span>,game_version) \n    <span class=\"hljs-comment\">// ./main.go:6:2: Printf format %s has arg 3 of wrong type int</span>\n}\n</code></pre><h1>lint</h1>\n<p>ä»£ç é™æ€æ£€æŸ¥</p>\n<p>golintã€golangci-lint</p>\n<h2>golangci-lint</h2>\n<blockquote>\n<p>å‚è€ƒ: <a href=\"https://golangci-lint.run/usage/configuration/\">https://golangci-lint.run/usage/configuration/</a></p>\n</blockquote>\n<p><code>golangci-lint run</code></p>\n<p><code>.golangci.yaml</code>é…ç½®linté€‰é¡¹</p>\n<h3>é…ç½®é¡¹</h3>\n<p>run</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">run:</span>\n  <span class=\"hljs-attr\">concurrency:</span> <span class=\"hljs-number\">4</span>\n  <span class=\"hljs-attr\">timeout:</span> <span class=\"hljs-string\">5m</span>\n  <span class=\"hljs-attr\">issues-exit-code:</span> <span class=\"hljs-number\">2</span>\n  <span class=\"hljs-attr\">tests:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">build-tags:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">mytag</span>\n  <span class=\"hljs-attr\">skip-dirs:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">src/external_libs</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">autogenerated_by_my_lib</span>\n  <span class=\"hljs-attr\">skip-dirs-use-default:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">skip-files:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;.*\\\\.my\\\\.go$&quot;</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lib/bad.go</span>\n  <span class=\"hljs-attr\">modules-download-mode:</span> <span class=\"hljs-string\">readonly</span> <span class=\"hljs-comment\"># readonly|vendor|mod</span>\n  <span class=\"hljs-attr\">allow-parallel-runners:</span> <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\"># If false (default) - golangci-lint acquires file lock on start.</span>\n  <span class=\"hljs-attr\">go:</span> <span class=\"hljs-string\">&#x27;1.18&#x27;</span>\n</code></pre><p>output</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">output:</span>\n  <span class=\"hljs-attr\">format:</span> <span class=\"hljs-string\">json</span> <span class=\"hljs-comment\"># colored-line-number|line-number|json|tab|checkstyle|code-climate|junit-xml|github-actions</span>\n  <span class=\"hljs-attr\">print-issued-lines:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">print-linter-name:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">uniq-by-line:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">path-prefix:</span> <span class=\"hljs-string\">&quot;&quot;</span>\n  <span class=\"hljs-attr\">sort-results:</span> <span class=\"hljs-literal\">false</span>\n</code></pre><p>linters</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">linters:</span>\n  <span class=\"hljs-attr\">disable-all:</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-comment\"># Default: false</span>\n  <span class=\"hljs-comment\"># Enable specific linter</span>\n  <span class=\"hljs-comment\"># https://golangci-lint.run/usage/linters/#enabled-by-default</span>\n  <span class=\"hljs-attr\">enable:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">asasalint</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">asciicheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">bidichk</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">bodyclose</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">containedctx</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">contextcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">cyclop</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">deadcode</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">decorder</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">depguard</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">dogsled</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">dupl</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">dupword</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">durationcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">errcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">errchkjson</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">errname</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">errorlint</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">execinquery</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">exhaustive</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">exhaustivestruct</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">exhaustruct</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">exportloopref</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">forbidigo</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">forcetypeassert</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">funlen</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gci</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gochecknoglobals</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gochecknoinits</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gocognit</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">goconst</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gocritic</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gocyclo</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">godot</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">godox</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">goerr113</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gofmt</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gofumpt</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">goheader</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">goimports</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">golint</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gomnd</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gomoddirectives</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gomodguard</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">goprintffuncname</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gosec</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gosimple</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">govet</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">grouper</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ifshort</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">importas</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ineffassign</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">interfacebloat</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">interfacer</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ireturn</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lll</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">loggercheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">maintidx</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">makezero</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">maligned</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">misspell</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nakedret</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nestif</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nilerr</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nilnil</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nlreturn</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">noctx</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nolintlint</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nonamedreturns</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nosnakecase</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nosprintfhostport</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">paralleltest</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">prealloc</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">predeclared</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">promlinter</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">reassign</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">revive</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">rowserrcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">scopelint</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">sqlclosecheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">staticcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">structcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">stylecheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">tagliatelle</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">tenv</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">testableexamples</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">testpackage</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">thelper</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">tparallel</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typecheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">unconvert</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">unparam</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">unused</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">usestdlibvars</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">varcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">varnamelen</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">wastedassign</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">whitespace</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">wrapcheck</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">wsl</span>\n  <span class=\"hljs-attr\">enable-all:</span> <span class=\"hljs-literal\">true</span>  <span class=\"hljs-comment\"># Default: false</span>\n  <span class=\"hljs-attr\">disable:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-comment\"># åŒenableé¡¹ä¸€æ ·</span>\n  <span class=\"hljs-comment\"># Enable presets.</span>\n  <span class=\"hljs-comment\"># https://golangci-lint.run/usage/linters</span>\n  <span class=\"hljs-attr\">presets:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">bugs</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">comment</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">complexity</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">error</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">format</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">import</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">metalinter</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">module</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">performance</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">sql</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">style</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">test</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">unused</span>\n  <span class=\"hljs-comment\"># Run only fast linters from enabled linters set (first run won&#x27;t be fast)</span>\n  <span class=\"hljs-comment\"># Default: false</span>\n  <span class=\"hljs-attr\">fast:</span> <span class=\"hljs-literal\">true</span>\n</code></pre><p>issues</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">issues:</span>\n  <span class=\"hljs-attr\">exclude:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">abcdef</span>\n  <span class=\"hljs-comment\"># Excluding configuration per-path, per-linter, per-text and per-source</span>\n  <span class=\"hljs-attr\">exclude-rules:</span>\n    <span class=\"hljs-comment\"># Exclude some linters from running on tests files.</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">_test\\.go</span>\n      <span class=\"hljs-attr\">linters:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gocyclo</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">errcheck</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">dupl</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gosec</span>\n    <span class=\"hljs-comment\"># Exclude known linters from partially hard-vendored code,</span>\n    <span class=\"hljs-comment\"># which is impossible to exclude via `nolint` comments.</span>\n    <span class=\"hljs-comment\"># `/` will be replaced by current OS file path separator to properly work on Windows.</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">internal/hmac/</span>\n      <span class=\"hljs-attr\">text:</span> <span class=\"hljs-string\">&quot;weak cryptographic primitive&quot;</span>\n      <span class=\"hljs-attr\">linters:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gosec</span>\n    <span class=\"hljs-comment\"># Exclude some `staticcheck` messages.</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">linters:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">staticcheck</span>\n      <span class=\"hljs-attr\">text:</span> <span class=\"hljs-string\">&quot;SA9003:&quot;</span>\n    <span class=\"hljs-comment\"># Exclude `lll` issues for long lines with `go:generate`.</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">linters:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lll</span>\n      <span class=\"hljs-attr\">source:</span> <span class=\"hljs-string\">&quot;^//go:generate &quot;</span>\n  <span class=\"hljs-attr\">exclude-use-default:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">exclude-case-sensitive:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-comment\"># The list of ids of default excludes to include or disable.</span>\n  <span class=\"hljs-comment\"># https://golangci-lint.run/usage/false-positives/#default-exclusions</span>\n  <span class=\"hljs-comment\"># Default: []</span>\n  <span class=\"hljs-attr\">include:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0001</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0002</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0003</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0004</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0005</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0006</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0007</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0008</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0009</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0010</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0011</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0012</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0013</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0014</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">EXC0015</span>\n  <span class=\"hljs-comment\"># Maximum issues count per one linter.</span>\n  <span class=\"hljs-comment\"># Set to 0 to disable.</span>\n  <span class=\"hljs-comment\"># Default: 50</span>\n  <span class=\"hljs-attr\">max-issues-per-linter:</span> <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-comment\"># Maximum count of issues with the same text.</span>\n  <span class=\"hljs-comment\"># Set to 0 to disable.</span>\n  <span class=\"hljs-comment\"># Default: 3</span>\n  <span class=\"hljs-attr\">max-same-issues:</span> <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-comment\"># Show only new issues: if there are unstaged changes or untracked files,</span>\n  <span class=\"hljs-comment\"># only those changes are analyzed, else only changes in HEAD~ are analyzed.</span>\n  <span class=\"hljs-comment\"># It&#x27;s a super-useful option for integration of golangci-lint into existing large codebase.</span>\n  <span class=\"hljs-comment\"># It&#x27;s not practical to fix all existing issues at the moment of integration:</span>\n  <span class=\"hljs-comment\"># much better don&#x27;t allow issues in new code.</span>\n  <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-comment\"># Default: false.</span>\n  <span class=\"hljs-attr\">new:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-comment\"># Show only new issues created after git revision `REV`.</span>\n  <span class=\"hljs-attr\">new-from-rev:</span> <span class=\"hljs-string\">HEAD</span>\n  <span class=\"hljs-comment\"># Show only new issues created in git patch with set file path.</span>\n  <span class=\"hljs-attr\">new-from-patch:</span> <span class=\"hljs-string\">path/to/patch/file</span>\n  <span class=\"hljs-comment\"># Fix found issues (if it&#x27;s supported by the linter).</span>\n  <span class=\"hljs-attr\">fix:</span> <span class=\"hljs-literal\">true</span>\n</code></pre><p>severity</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">severity:</span>\n  <span class=\"hljs-attr\">default-severity:</span> <span class=\"hljs-string\">error</span>\n  <span class=\"hljs-attr\">case-sensitive:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">rules:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">linters:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">dupl</span>\n      <span class=\"hljs-attr\">severity:</span> <span class=\"hljs-string\">info</span>\n</code></pre><h1>å•å…ƒæµ‹è¯•</h1>\n<p>åœ¨å•å…ƒæµ‹è¯•é¢†åŸŸï¼Œå…³äºå¦‚ä½•æ›¿æ¢æ‰å¤–éƒ¨ä¾èµ–ï¼Œä¸»è¦æœ‰ä¸¤ç§æŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯ mock å’Œ stubï¼šmock é€šè¿‡æ¥å£å¯ä»¥åŠ¨æ€è°ƒæ•´å¤–éƒ¨ä¾èµ–çš„è¿”å›å€¼ï¼Œè€Œ stub åªèƒ½åœ¨è¿è¡Œæ—¶é™æ€è°ƒæ•´å¤–éƒ¨ä¾èµ–çš„è¿”å›å€¼</p>\n<blockquote>\n<p>ä½¿ç”¨è¿™äº›éƒ½æ˜¯å°±æ˜¯ä¸ºäº†æ›¿æ¢å¤–éƒ¨ä¾èµ–æ—¶å€™ä½¿ç”¨çš„ï¼Œåªæ˜¯ä¸ºäº†å•å…ƒæµ‹è¯•è¦†ç›–ç‡å˜é«˜ä¸€ç‚¹ğŸ˜¹</p>\n</blockquote>\n<pre><code class=\"hljs language-bash\">github.com/stretchr/testify/<span class=\"hljs-keyword\">assert</span>\n\ngithub.com/smartystreets/goconvey/convey\n\ngithub.com/golang/mock/gomock\n</code></pre><p><code>go install github.com/golang/mock/mockgen@latest</code></p>\n<h2>gotest</h2>\n<p>å®˜æ–¹å†…ç½®çš„å·¥å…·</p>\n<ul>\n<li>æ€§èƒ½æµ‹è¯•</li>\n</ul>\n<p><code>go test -bench</code></p>\n<p>å®šä¹‰Benchå¼€å¤´çš„æµ‹è¯•å‡½æ•°</p>\n<ul>\n<li>è¦†ç›–ç‡</li>\n</ul>\n<p><code>go test -cover</code></p>\n<ul>\n<li>ç«æ€æ£€æŸ¥</li>\n</ul>\n<p><code>go test -race</code>ç”¨äºæ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨å¹¶å‘å®‰å…¨é—®é¢˜</p>\n<h2>testify</h2>\n<ul>\n<li>assert</li>\n<li>require(ä¸assertä¸€æ ·ï¼Œä¸è¿‡å¼‚å¸¸ä¼šé€€å‡º)</li>\n<li>mock</li>\n</ul>\n<blockquote>\n<p>åœ¨è¦ç¼–å†™ä¸€ä¸ªä»ä¸€ä¸ªç«™ç‚¹æ‹‰å–ç”¨æˆ·åˆ—è¡¨ä¿¡æ¯çš„ç¨‹åºï¼Œæ‹‰å–å®Œæˆä¹‹åç¨‹åºæ˜¾ç¤ºå’Œåˆ†æã€‚å¦‚æœæ¯æ¬¡éƒ½å»è®¿é—®ç½‘ç»œä¼šå¸¦æ¥æå¤§çš„ä¸ç¡®å®šæ€§ï¼Œç”šè‡³æ¯æ¬¡è¿”å›ä¸åŒçš„åˆ—è¡¨ï¼Œè¿™å°±ç»™æµ‹è¯•å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mock æŠ€æœ¯ã€‚</p>\n</blockquote>\n<p>ä½†æ˜¯é—®é¢˜åœ¨äºå¦‚æœç›´æ¥ä½¿ç”¨æ–°çš„æ¥å£è¿›è¡Œäº†æ›¿æ¢ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æœ‰äº›ä»£ç åˆ†æ”¯è¿›å…¥ä¸åˆ°ï¼Œè¦†ç›–ç‡é™ä½</p>\n<ul>\n<li>suite</li>\n</ul>\n<h2>gomock</h2>\n<p><code>go mock</code></p>\n<pre><code class=\"hljs language-bash\">go get -u github.com/golang/mock/gomock go get -u github.com/golang/mock/mockgen\n</code></pre><p>è¦ä½¿ç”¨gomockçš„ä¸€ä¸ªå‰ææ˜¯æ¨¡å—ä¹‹é—´åŠ¡å¿…é€šè¿‡æ¥å£è¿›è¡Œä¾èµ–ï¼Œè€Œä¸æ˜¯ä¾èµ–å…·ä½“å®ç°ï¼Œå¦åˆ™mockä¼šéå¸¸å›°éš¾ã€‚è¿™ä¸ªå·¥å…·ç›®å‰ä¸šç•Œç”¨çš„å¹¶ä¸å¤šï¼Œä¸»è¦æ˜¯å±€é™æ€§å¤ªå¤§</p>\n<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå½“éœ€è¦è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œå¾€å¾€ä¼šæœ‰å¾ˆå¤šçš„ä¾èµ–é¡¹ï¼Œæœ‰äº›ä¾èµ–å¯èƒ½è¿˜æ²¡æœ‰åŠæ³•ç›´æ¥è¿›è¡Œåˆ›å»ºï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ï¼Œæ–‡ä»¶ I/O ç­‰ã€‚æ­¤æ—¶é€šè¿‡ä½¿ç”¨ go mock å¯ä»¥æ¨¡æ‹Ÿä¾èµ–é¡¹ï¼Œç®€åŒ–æµ‹è¯•ã€‚</p>\n<p><strong>æ¡©</strong>ï¼Œæˆ–ç§°æ¡©ä»£ç ï¼Œæ˜¯æŒ‡ç”¨æ¥ä»£æ›¿å…³è”ä»£ç æˆ–è€…æœªå®ç°ä»£ç çš„ä»£ç ã€‚å¦‚æœå‡½æ•° B ç”¨ B1 æ¥ä»£æ›¿ï¼Œé‚£ä¹ˆï¼ŒB ç§°ä¸ºåŸå‡½æ•°ï¼ŒB1 ç§°ä¸ºæ¡©å‡½æ•°ã€‚æ‰“æ¡©å°±æ˜¯ç¼–å†™æˆ–ç”Ÿæˆæ¡©ä»£ç ã€‚</p>\n<h2>gostub</h2>\n<p><code>go get github.com/prashantv/gostub</code></p>\n<ul>\n<li>ä¸ºä¸€ä¸ªå…¨å±€å˜é‡æ‰“æ¡©</li>\n<li>ä¸ºä¸€ä¸ªå‡½æ•°æ‰“æ¡©</li>\n<li>ä¸ºä¸€ä¸ªè¿‡ç¨‹æ‰“æ¡©</li>\n<li>ç”±ä»»æ„ç›¸åŒæˆ–ä¸åŒçš„åŸºæœ¬åœºæ™¯ç»„åˆè€Œæˆ</li>\n</ul>\n<pre><code class=\"hljs language-go\">func <span class=\"hljs-title class_\">TestStubMethod</span>(t *testing.<span class=\"hljs-property\">T</span>) {\n    <span class=\"hljs-keyword\">var</span> printStr = <span class=\"hljs-title function_\">func</span>(val string) string {\n        <span class=\"hljs-keyword\">return</span> val\n    }\n\n    <span class=\"hljs-comment\">// é’ˆå¯¹æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„</span>\n    stubs := gostub.<span class=\"hljs-title class_\">Stub</span>(&amp;printStr, <span class=\"hljs-title function_\">func</span>(val string) string {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;hello,&quot;</span> + val\n    })\n    defer stubs.<span class=\"hljs-title class_\">Reset</span>()\n    fmt.<span class=\"hljs-title class_\">Println</span>(<span class=\"hljs-string\">&quot;After stub: &quot;</span>, <span class=\"hljs-title function_\">printStr</span>(<span class=\"hljs-string\">&quot;hhhhh&quot;</span>))\n\n    <span class=\"hljs-keyword\">var</span> printStr2 = <span class=\"hljs-title function_\">func</span>(val string) string {\n        <span class=\"hljs-keyword\">return</span> val\n    }\n    <span class=\"hljs-comment\">// StubFunc ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°å˜é‡çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘çš„å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°å˜é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå‡½æ•° mock çš„è¿”å›å€¼</span>\n    stubs2 := gostub.<span class=\"hljs-title class_\">StubFunc</span>(&amp;printStr2, <span class=\"hljs-string\">&quot;ddddd,ä¸‡ç”Ÿä¸–ä»£&quot;</span>)\n    defer stubs2.<span class=\"hljs-title class_\">Reset</span>()\n    fmt.<span class=\"hljs-title class_\">Println</span>(<span class=\"hljs-string\">&quot;After stub:&quot;</span>, <span class=\"hljs-title function_\">printStr2</span>(<span class=\"hljs-string\">&quot;lalala&quot;</span>))\n}\n</code></pre><h2>gomonkey</h2>\n<p><code>github.com/agiledragon/gomonkey/v2</code></p>\n<p>1ã€å®ƒè¿åäº†å¼€é—­åŸåˆ™ã€‚\n2ã€è¿è¡Œæ—¶å¿…é¡»å…³é—­å†…è¿ã€Œgo test -gcflags=all=-lã€ã€‚\n3ã€è¿è¡Œæ—¶éœ€è¦å¾ˆé«˜çš„æƒé™ï¼Œå¹¶ä¸”ä¸åŒçš„ç¡¬ä»¶éœ€è¦ä¸åŒçš„é»‘ç§‘æŠ€å®ç°</p>\n<ol>\n<li>ç›´æ¥åœ¨æ–¹æ³•çº§åˆ«ä¸Šè¿›è¡Œ mock<br>ï¼ˆåœ¨è¿è¡Œæ—¶é€šè¿‡æ±‡ç¼–è¯­å¥é‡å†™å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†å¾…æ‰“æ¡©å‡½æ•°æˆ–æ–¹æ³•çš„å®ç°è·³è½¬åˆ°æ¡©å®ç°ï¼‰<br>åœ¨ç¼–è¯‘é˜¶æ®µç›´æ¥æ›¿æ¢æ‰çœŸçš„å‡½æ•°ä»£ç éƒ¨åˆ†  </li>\n<li>éçº¿ç¨‹å®‰å…¨ï¼Œè¯·å‹¿ç”¨äºå¹¶å‘æµ‹è¯•</li>\n</ol>\n<p>å¹¶ä¸”å¿…é¡»åŠ ä¸Š<code>&quot;-gcflags=all=-l&quot;</code>, é¿å…å†…è”ä¼˜åŒ–(çŸ­å‡½æ•°ç›´æ¥è¢«åˆå¹¶ä¸ä¼šå•ç‹¬ä½œä¸ºä¸€ä¸ªå‡½æ•°)å¯¼è‡´æµ‹è¯•å¤±è´¥</p>\n<pre><code class=\"hljs language-go\">func DoSomething(name string, args ...string) (string, error) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;&quot;</span>, errors.New(<span class=\"hljs-string\">&quot;TODO&quot;</span>)\n}\n\nfunc TestExec(t *testing.T) {\n    patches := gomonkey.NewPatches()\n    defer patches.Reset()\n    outputExpect := <span class=\"hljs-string\">&quot;xxx-vethName100-yyy&quot;</span>\n    guard := patches.ApplyFunc(DoSomething, func(_ string, _ ...string) (string, error) {\n        <span class=\"hljs-keyword\">return</span> outputExpect, nil\n    })\n    defer guard.Reset()\n    output, err := DoSomething(<span class=\"hljs-string\">&quot;asd&quot;</span>, <span class=\"hljs-string\">&quot;1&quot;</span>, <span class=\"hljs-string\">&quot;2&quot;</span>, <span class=\"hljs-string\">&quot;3&quot;</span>)\n    <span class=\"hljs-keyword\">assert</span>.Nil(t, err)\n    <span class=\"hljs-keyword\">assert</span>.Equal(t, outputExpect, output)\n}\n</code></pre><h2>httpæµ‹è¯•</h2>\n<p>åœ¨ web é¡¹ç›®ä¸­ï¼Œå¤§å¤šæ¥å£æ˜¯å¤„ç† http è¯·æ±‚ï¼ˆpostã€get ä¹‹ç±»çš„ï¼‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ˜¯è®¿é—®ä¸åˆ°å®ƒå‘èµ·çš„ get è¯·æ±‚çš„ url çš„ï¼Œæ­¤æ—¶å°±å¯ä»¥æ¨¡æ‹Ÿ http è¯·æ±‚æ¥å†™æµ‹è¯•ã€‚å¯ä»¥åˆ©ç”¨å®˜æ–¹è‡ªå¸¦çš„ http åŒ…æ¥è¿›è¡Œæ¨¡æ‹Ÿè¯·æ±‚ã€‚</p>\n<h2>sqlæµ‹è¯•</h2>\n<p>æ¨¡æ‹Ÿä»»ä½•å®ç°äº† sql/driver æ¥å£çš„ db é©±åŠ¨ï¼Œæ— éœ€å…³æ³¨ db è¿æ¥ã€‚</p>\n<h1>æ€§èƒ½è°ƒä¼˜</h1>\n<p>ä½¿ç”¨goå†…ç½®çš„å·¥å…·pprofå³å¯åˆ†æç¨‹åºè¿è¡ŒçŠ¶æ€çš„æ•´ä½“æƒ…å†µ</p>\n<table>\n<thead>\n<tr>\n<th>allocs</th>\n<th>å†…å­˜åˆ†é…æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>blocks</td>\n<td>é˜»å¡æ“ä½œæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>cmdline</td>\n<td>ç¨‹åºå¯åŠ¨å‘½ä»¤å‚æ•°</td>\n</tr>\n<tr>\n<td>goroutine</td>\n<td>æ‰€æœ‰åç¨‹çš„å †æ ˆä¿¡æ¯</td>\n</tr>\n<tr>\n<td>heap</td>\n<td>å †ä¸Šçš„å†…å­˜åˆ†é…æƒ…å†µ</td>\n</tr>\n<tr>\n<td>mutex</td>\n<td>é”ç«äº‰æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>profile</td>\n<td>cpuå ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>threadcreate</td>\n<td>ç³»ç»Ÿçº¿ç¨‹åˆ›å»ºæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>trace</td>\n<td>ç¨‹åºè¿è¡Œè·Ÿè¸ªä¿¡æ¯</td>\n</tr>\n</tbody></table>\n<ul>\n<li>runtim/pprof: æ‰‹åŠ¨è°ƒç”¨ï¼Œä¸€èˆ¬åœ¨å‡½æ•°å…¥å£ä¸­</li>\n<li>net/http/pprof: ç”¨äºwebç³»ç»Ÿä¸­ï¼Œä¸è¿‡åªæ˜¯å¯¹runtime/pprofçš„ç®€å•å°è£…</li>\n<li>gin-contribæä¾›äº†å¯¹net/http/pprofçš„å°è£…ï¼Œèƒ½å¤Ÿåœ¨ginä¸­ä½¿ç”¨</li>\n</ul>\n<blockquote>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œprofileæ‰€æ˜¾ç¤ºçš„æ—¶é—´æ˜æ˜¾å°äºæ¥å£è°ƒç”¨çš„æ—¶é—´ï¼Œæ˜¯å› ä¸ºprofileåªèƒ½å¤Ÿåˆ†æcpuçš„è€—æ—¶ï¼Œæ— æ³•è®¡ç®—ioæƒ…å†µ(å› ä¸ºioä¸ä¼šå ç”¨cpu)</p>\n</blockquote>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># ä¸‹è½½cpu profileï¼Œé»˜è®¤ä»å½“å‰å¼€å§‹æ”¶é›†30sçš„cpuä½¿ç”¨æƒ…å†µï¼Œéœ€è¦ç­‰å¾…30s</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/profile</span>   <span class=\"hljs-comment\"># 30-second CPU profile</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/profile?seconds=120</span>     <span class=\"hljs-comment\"># wait 120s</span>\n\n<span class=\"hljs-comment\"># ä¸‹è½½heap profile</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/heap</span>      <span class=\"hljs-comment\"># heap profile</span>\n\n<span class=\"hljs-comment\"># ä¸‹è½½goroutine profile</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/goroutine</span> <span class=\"hljs-comment\"># goroutine profile</span>\n\n<span class=\"hljs-comment\"># ä¸‹è½½block profile</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/block</span>     <span class=\"hljs-comment\"># goroutine blocking profile</span>\n\n<span class=\"hljs-comment\"># ä¸‹è½½mutex profile</span>\n<span class=\"hljs-string\">go</span> <span class=\"hljs-string\">tool</span> <span class=\"hljs-string\">pprof</span> <span class=\"hljs-string\">http://localhost:6060/debug/pprof/mutex</span>\n</code></pre><h2>trace</h2>\n<p>traceå·¥å…·ï¼Œç”¨äºæŸ¥çœ‹æ•´ä¸ªå‘¨æœŸå†…å‘ç”Ÿçš„äº‹ä»¶ï¼ŒæŒ‡å®šçš„Goroutinesä½•æ—¶æ‰§è¡Œã€æ‰§è¡Œ äº†å¤šé•¿æ—¶é—´ã€ä»€ä¹ˆæ—¶å€™é™·å…¥äº†å µå¡ã€ä»€ä¹ˆæ—¶å€™è§£é™¤äº†å µå¡ã€GCå¦‚ä½•å½± å“å•ä¸ªGoroutineçš„æ‰§è¡Œã€STWä¸­æ–­èŠ±è´¹çš„æ—¶é—´æ˜¯å¦å¤ªé•¿ç­‰ ã€‚</p>\n<ul>\n<li>åç¨‹çš„åˆ›å»ºã€å¼€å§‹å’Œç»“æŸ</li>\n<li>åç¨‹çš„å µå¡-ç³»ç»Ÿè°ƒç”¨ã€é€šé“ã€é”</li>\n<li>ç½‘ç»œI/Oç›¸å…³äº‹ä»¶</li>\n<li>ç³»ç»Ÿè°ƒç”¨äº‹ä»¶</li>\n<li>åƒåœ¾å›æ”¶ç›¸å…³äº‹ä»¶</li>\n</ul>\n<pre><code class=\"hljs language-go\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;runtime/trace&quot;</span>\n\ntrace.<span class=\"hljs-title class_\">Start</span>(f)\n\ndefer trace.<span class=\"hljs-title class_\">Stop</span>()\n\n<span class=\"hljs-comment\">// or use net/pprof</span>\n<span class=\"hljs-comment\">// curl -o trace.out http.../debug/pprof/trace?second=20</span>\n\n<span class=\"hljs-comment\">// ç„¶åä½¿ç”¨go tool trace trace.outè¿›è¡Œåˆ†æ</span>\n</code></pre><p>åœ¨traceçš„åˆå§‹é˜¶æ®µéœ€è¦é¦–å…ˆSTWï¼Œç„¶åè·å–åç¨‹çš„å¿«ç…§ã€çŠ¶æ€ã€æ ˆå¸§ä¿¡æ¯ï¼Œç„¶åå¼€å¯GCé‡æ–°å¯åŠ¨æ‰€æœ‰åç¨‹ã€‚goæºç ä¸­å¯¹äºå…³é”®äº‹ä»¶éƒ½åŠ äº†åˆ¤æ–­æ˜¯å¦å¼€å¯äº†traceï¼Œå¼€å¯åï¼Œè§¦å‘è¿™äº›äº‹ä»¶æ—¶éƒ½ä¼šå†™å…¥ã€‚</p>\n<p>å…³é”®çš„äº‹ä»¶åŒ…æ‹¬åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€åç¨‹å µå¡ã€ç½‘ç»œI/Oã€ç³»ç»Ÿ è°ƒç”¨ã€åƒåœ¾å›æ”¶ç­‰ï¼Œæ ¹æ®äº‹ä»¶çš„ä¸åŒï¼Œå¯èƒ½ä¿å­˜å’Œæ­¤äº‹ä»¶ç›¸å…³çš„ä¸åŒ æ•°é‡çš„å‚æ•°åŠæ ˆè¿½è¸ªæ•°æ®ã€‚æ¯ä¸ªé€»è¾‘å¤„ç†å™¨Péƒ½æœ‰ä¸€ä¸ªç¼“å­˜ (p.tracebuf)ï¼Œç”¨äºå­˜å‚¨å·²ç»è¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚çš„äº‹ä»¶(Event) ã€‚æ¯ä¸ªpçš„tracebuféƒ½æœ‰é™åº¦ï¼Œè¶…è¿‡ä¹‹åä¼šè½¬ç§»åˆ°å…¨å±€é“¾è¡¨ã€‚</p>\n<p>traceå·¥å…·ä¼šæ–°å¼€ä¸€ä¸ªåç¨‹ä¸“é—¨ç”¨äºè¯»å–å…¨å±€traceä¸Šçš„ä¿¡æ¯ï¼Œ æ­¤æ—¶å…¨å±€çš„äº‹ä»¶å¯¹è±¡å·²ç»æ˜¯åºåˆ—åŒ–ä¹‹åçš„å­—èŠ‚æ•°ç»„ï¼Œç›´æ¥æ·»åŠ åˆ°æ–‡ä»¶ ä¸­å³å¯ã€‚å¦å¤–ï¼Œè®¿é—®å…¨å±€traceç¼“å­˜éœ€è¦åŠ é”ï¼Œå½“æ²¡æœ‰å¯ä»¥è®¿é—®çš„å¯¹è±¡ æ—¶ï¼Œè¯»å–åç¨‹ä¼šé™·å…¥ä¼‘çœ çŠ¶æ€ ã€‚</p>\n<p>å½“æŒ‡å®šçš„äº‹ä»¶åˆ°æœŸåç»“æŸtraceä»»åŠ¡ç¨‹åºå†æ¬¡è¿›å…¥STWï¼Œåˆ·æ–°é€»è¾‘å¤„ç†å™¨Pä¸Šçš„tracebufç¼“å­˜</p>\n<h2>pyroscope</h2>\n<p>åŸºäºpprofæ•°æ®çš„å¯è§†åŒ–å·¥å…·ï¼Œæä¾›ä¸ŠæŠ¥å’Œæ‹‰å–ä¸¤ç§æ¨¡å¼</p>\n<p>æ”¯æŒå¤šç§è¯­è¨€</p>\n<p>å¯ä»¥å°†å„ä¸ªæœåŠ¡çš„è¿è¡Œæ•°æ®é›†ä¸­èµ·æ¥ï¼Œæ›´åˆ©äºç®¡ç†</p>\n<p>ä¸è¿‡åªèƒ½è·å–åˆ°å½“å‰æ—¶é—´ç‚¹çš„å†…å­˜åˆ†é…æƒ…å†µã€å½“å‰ä½¿ç”¨çš„å†…å­˜æƒ…å†µï¼Œä»¥åŠCPUè€—æ—¶ç­‰</p>\n<p><del>å¦å¤–ï¼Œé™¤äº†æ— æ³•å¯¹åç¨‹æ•°ã€mutexç­‰è¿›è¡Œåˆ†æ</del>, åˆé”™æ€ªäº†ğŸ˜¹ï¼Œpyroscopeæ”¯æŒçš„åˆ†æç»´åº¦åŒ…æ‹¬(cpuã€inuse_objectsã€alloc_objectsã€inuse_spaceï¼Œalloc_space, goroutinesã€mutex_durationã€block_countã€block_durationï¼Œè¿™é‡Œé¢é™¤äº†pprofï¼Œåº”è¯¥è¿˜ç”¨äº†traceåŒ…é‡Œé¢çš„æ•°æ®)</p>\n<p><del>ç»˜åˆ¶çš„æ—¶é—´æ›²çº¿æ²¡æœ‰å…·ä½“çš„æ•°å€¼ï¼Œä¹Ÿæ— æ³•æŸ¥çœ‹å…·ä½“æ—¶é—´ç‚¹ä¸‹çš„æ•°æ®æƒ…å†µ</del>(é”™æ€ªäº†ï¼Œæ—¶é—´åŒºé—´é€‰æ‹©å¯ä»¥ç”¨é¼ æ ‡æ»‘åŠ¨é€‰æ‹©ï¼Œæ— æ³•ç‚¹å‡»æŸä¸ªç‰¹å®šçš„æŸ±å½¢ç»“æ„)</p>\n<h2>æ’æŸ¥CPUå ç”¨è¿‡é«˜</h2>\n<p>topå‘½ä»¤ç¡®è®¤</p>\n<p><code>go tool pprof http://localhost:6060/debug/pprof/profile</code></p>\n<p>è¿›å…¥äº¤äº’ä½¿ç”¨topæŸ¥çœ‹CPUå ç”¨è¾ƒé«˜çš„è°ƒç”¨</p>\n<p>top</p>\n<p>ä½¿ç”¨list åå­— æŸ¥çœ‹è°ƒç”¨çš„å…·ä½“ä½ç½®</p>\n<p>list Eat</p>\n<p>å¦‚æœå®‰è£…äº†graphvizå·¥å…·ï¼Œä½¿ç”¨webå‘½ä»¤ä¹‹åèƒ½å¤Ÿåœ¨webç•Œé¢ä¸Šçœ‹åˆ°è°ƒç”¨é“¾è·¯å›¾</p>\n<p>brew install graphviz</p>\n<img src=\"/images/blogs/cpu-web.png\" />\n\n<p>ä¿®å¤é—®é¢˜ä»£ç ç»§ç»­åé¢çš„æ“ä½œ</p>\n<h2>æ’æŸ¥å†…å­˜å ç”¨è¿‡é«˜</h2>\n<p>ä¿®å¤ä»£ç ä¸­çš„æ­»å¾ªç¯ï¼Œå†æ¬¡ä½¿ç”¨topä¼šå‘ç°CPUå ç”¨ç‡ä¸‹æ¥äº†</p>\n<p><code>go tool pprof http://localhost:6060/debug/pprof/heap</code></p>\n<p>å†æ¬¡ä½¿ç”¨topã€listå®šä½åˆ°é—®é¢˜ä»£ç </p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-attr\">Total:</span> <span class=\"hljs-number\">1.</span><span class=\"hljs-string\">50GB</span>\n<span class=\"hljs-string\">ROUTINE</span> <span class=\"hljs-string\">========================</span> <span class=\"hljs-string\">github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">/Users/dengronghui/Documents/Apps/public/handbook/Golang/go-pprof-practice-master/animal/muridae/mouse/mouse.go</span>\n    <span class=\"hljs-number\">1.</span><span class=\"hljs-string\">50GB</span>     <span class=\"hljs-number\">1.</span><span class=\"hljs-string\">50GB</span> <span class=\"hljs-string\">(flat,</span> <span class=\"hljs-string\">cum)</span> <span class=\"hljs-number\">99.90</span><span class=\"hljs-string\">%</span> <span class=\"hljs-string\">of</span> <span class=\"hljs-string\">Total</span>\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-attr\">45:</span>\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-number\">46</span><span class=\"hljs-string\">:func</span> <span class=\"hljs-string\">(m</span> <span class=\"hljs-string\">*Mouse)</span> <span class=\"hljs-string\">Steal()</span> {\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-attr\">47:</span>\t<span class=\"hljs-string\">log.Println(m.Name()</span>, <span class=\"hljs-string\">&quot;steal&quot;</span><span class=\"hljs-string\">)</span>\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-attr\">48:</span>\t<span class=\"hljs-string\">max</span> <span class=\"hljs-string\">:=</span> <span class=\"hljs-string\">constant.Gi</span>\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-attr\">49:</span>\t<span class=\"hljs-string\">for</span> <span class=\"hljs-string\">len(m.buffer)*constant.Mi</span> <span class=\"hljs-string\">&lt;</span> <span class=\"hljs-string\">max</span> {\n    <span class=\"hljs-attr\">1.50GB     1.50GB     50:</span>\t\t<span class=\"hljs-string\">m.buffer</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">append(m.buffer</span>, [<span class=\"hljs-string\">constant.Mi</span>]<span class=\"hljs-string\">byte</span>{}<span class=\"hljs-string\">)</span>\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-attr\">51:</span>\t}\n         <span class=\"hljs-string\">.</span>          <span class=\"hljs-string\">.</span>     <span class=\"hljs-number\">52</span><span class=\"hljs-string\">:</span>}\n</code></pre><p>åŒæ ·å¯ä»¥ä½¿ç”¨webå¯è§†åŒ–å±•ç¤º</p>\n<h2>æ’æŸ¥é¢‘ç¹å†…å­˜å›æ”¶</h2>\n<p>è·å–ç¨‹åºè¿è¡Œæ—¶çš„GCæ—¥å¿—</p>\n<pre><code class=\"hljs language-bash\">gc 1 @0.003s 7%: 0.022+2.1+0.002 ms clock, 0.18+1.1/1.9/3.0+0.019 ms cpu, 4-&gt;4-&gt;3 MB, 5 MB goal, 8 P\ngc 2 @0.018s 3%: 0.009+1.8+0.001 ms clock, 0.073+0.096/2.2/0.16+0.013 ms cpu, 7-&gt;7-&gt;6 MB, 8 MB goal, 8 P\ngc 3 @0.089s 0%: 0.022+0.92+0.013 ms clock, 0.17+0.095/1.0/0.75+0.10 ms cpu, 16-&gt;16-&gt;14 MB, 17 MB goal, 8 P\ngc 4 @0.489s 0%: 0.023+1.5+0.014 ms clock, 0.18+0/2.4/1.1+0.11 ms cpu, 29-&gt;29-&gt;15 MB, 30 MB goal, 8 P\ngc 1 @0.003s 1%: 0.013+0.55+0.002 ms clock, 0.013+0.22/0.17/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\ngc 2 @3.020s 0%: 0.070+0.56+0.002 ms clock, 0.070+0.17/0.20/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\ngc 3 @6.027s 0%: 0.15+0.98+0.003 ms clock, 0.15+0.36/0.36/0+0.003 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\ngc 4 @9.034s 0%: 0.10+0.63+0.002 ms clock, 0.10+0.16/0.23/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\ngc 5 @12.040s 0%: 0.070+0.53+0.002 ms clock, 0.070+0.23/0.19/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\ngc 6 @15.047s 0%: 0.11+0.66+0.002 ms clock, 0.11+0.23/0.27/0+0.002 ms cpu, 16-&gt;16-&gt;0 MB, 17 MB goal, 1 P\n</code></pre><img src=\"/images/blogs/gc_info.png\" />\n\n<p>æ¯æ¬¡gcéƒ½ä»16MBé‡Šæ”¾åˆ°0MBï¼Œè¯´æ˜ç¨‹åºåœ¨ä¸æ–­çš„å£°æ˜ç„¶åé‡Šæ”¾å†…å­˜</p>\n<p>æ¥ä¸‹æ¥ä½¿ç”¨ pprof æ’æŸ¥æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¹çš„ä¸æ˜¯ä»€ä¹ˆåœ°æ–¹åœ¨å ç”¨å¤§é‡å†…å­˜ï¼Œè€Œæ˜¯ä»€ä¹ˆåœ°æ–¹åœ¨ä¸åœåœ°ç”³è¯·å†…</p>\n<p><code>go tool pprof http://localhost:6060/debug/pprof/allocs</code></p>\n<h2>æ’æŸ¥åç¨‹æ³„æ¼</h2>\n<p><code>go tool pprof http://localhost:6060/debug/pprof/goroutine</code></p>\n<p>åŒæ ·ä½¿ç”¨topã€listã€webå³å¯å®šä½åˆ°</p>\n<h2>æ’æŸ¥é”çš„äº‰ç”¨</h2>\n<p><code>go tool pprof http://localhost:6060/debug/pprof/mutex</code></p>\n","frontMatter":{"readingTime":{"text":"21 min read","minutes":20.295,"time":1217700,"words":4059},"slug":"golangå·¥ç¨‹åŒ–æ€»è§ˆ","fileName":"golangå·¥ç¨‹åŒ–æ€»è§ˆ.md","title":"golangå·¥ç¨‹åŒ–çºµè§ˆ","date":"2022-07-03T00:00:00.000Z","tags":["Golang"],"draft":false,"summary":"golangå·¥ç¨‹åŒ–æ‰€ç”¨åˆ°çš„å·¥å…·æ¦‚è§ˆ"}},"prev":{"title":"go-zeroå¾®æœåŠ¡å®è·µ","date":"2022-06-20T00:00:00.000Z","tags":["å®è·µ","äº‘åŸç”Ÿ"],"draft":false,"summary":"å¾®æœåŠ¡ç®€ä»‹ä»¥åŠgo-zeroå¦‚ä½•è½åœ°","slug":"go-zeroå¾®æœåŠ¡å®è·µ"},"next":{"title":"å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ¨¡å¼","date":"2022-07-04T00:00:00.000Z","tags":["å®¹å™¨"],"draft":false,"summary":"å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ¨¡å¼ç®€ä»‹","slug":"å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ¨¡å¼"}},"__N_SSG":true}